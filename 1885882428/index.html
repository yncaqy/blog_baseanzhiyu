<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta name="google-site-verification" content="aVBJm2A8QVD7747StU6Nsb-tNrdIDVPgWrHm-mqh1PY"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>DRF框架 | YNCAQY</title><meta name="keywords" content="DRF框架"><meta name="author" content="月念尘"><meta name="copyright" content="月念尘"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="DRF框架"><meta name="application-name" content="DRF框架"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#ffffff"><meta property="og:type" content="article"><meta property="og:title" content="DRF框架"><meta property="og:url" content="https://ync.aqyync.top/1885882428/index.html"><meta property="og:site_name" content="YNCAQY"><meta property="og:description" content="DRF框架1 DRF入门1.1 RESTful REST与技术无关，它是一种 软件架构风格 ，REST是Representational State Transfer的简称，中文翻译为“ 表征状态转移 ” REST从资源的角度类审视整个网络，它将分布在网络中某个节点的 资源通过URL进行标识 ，客户"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://ync.aqyync.top/img/article_cover/DRF%E6%A1%86%E6%9E%B6.jpg"><meta property="article:author" content="月念尘"><meta property="article:tag" content="YNCAQY, ync, 博客, Blog, Hexo, butterfly"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://ync.aqyync.top/img/article_cover/DRF%E6%A1%86%E6%9E%B6.jpg"><meta name="description" content="DRF框架1 DRF入门1.1 RESTful REST与技术无关，它是一种 软件架构风格 ，REST是Representational State Transfer的简称，中文翻译为“ 表征状态转移 ” REST从资源的角度类审视整个网络，它将分布在网络中某个节点的 资源通过URL进行标识 ，客户"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://ync.aqyync.top/1885882428/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2024/07/27/125766904/ba62475f396df9de3316a08ed9e65d86_5680958632268053399..png"},
  postHeadAiDescription: {"enable":true,"gptName":"YncAqy","mode":"tianli","switchBtn":true,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"WUBlTmmbtX4","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 月念尘","link":"链接: ","source":"来源: YNCAQY","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'YNCAQY',
  title: 'DRF框架',
  postAI: 'true',
  pageFillDescription: 'DRF框架, 1 DRF入门, 1.1 RESTful, 1.2 API接口和 RESTful API规范, 1.3 Django-RESTful介绍与安装, 1.3.1 介绍, 1.3.2 安装DRF, 1.3.3 配置DRF, 1.3.4 serializer.py新建一个序列化类（该文件也自己创建）, 1.3.5 视图类, 1.3.6 编写路由, 1.3.7 启动项目开始测试, 2 DRF功能组件, 2.1 认证Authentication, 2.1.1 认证配置, 2.1.2 认证使用, 2.1.3 提供的权限, 2.1.4 自定义权限, 2.2 限流Throttling, 2.2.1 限流介绍, 2.2.2 限流使用, 2.2.3 可选限流类, 2.2.4 案例, 2.3 过滤Filtering, 2.3.1 基本用法, 2.3.2 排序, 2.4 分页, 2.4.1 基本用法, 2.4.2 可选分页器, 2.5 异常处理Exceptions, 2.6 自动生成接口文档, 2.6.1 安装依赖, 2.6.2 设置接口文档访问路径, 2.6.3 文档描述说明的定义位置, 2.6.4 访问接口文档网页, 3 DRF视图家族, 3.1 两个视图基类, 3.1.1 APIView, 3.1.2 GenericAPIView, 3.1.3 DRF的请求对象, 1）.data, 2）.query_params, 3）request._request, 3.1.4 DRF的响应对象, 1）response的构造方式, 2）response对象的状态码, 3.1.5 视图类源码解析, 1、View类的源码解析, 2、APIView源码解析, 3、GenericAPIView源码解析, 3.2  5个视图扩展类, (1) ListModeMixin, (2) CreateModeMixin, (3) RetrieveModelMixin, (4) UpdateModelMixin, (5) DestroyModelMixin, 3.3 几个子类视图, (1）CreateAPIView, (2）ListAPIView, (3）RetrieveAPIView, (4）DestoryAPIView, (5）UpdateAPIView, 6）RetrieveUpdateAPIView, 7）RetrieveUpdateDestoryAPIView, 3.4 视图集ViewSet, 3.4.1 常用视图集父类, 3.4.2 视图集中定义附加action动作, 3.4.3 action属性, 3.5 路由Routers, 3.5.1 使用方法, 3.5.2 视图集中附加action的声明, 3.5.3 路由router形成URL的方法, 4 JWT, 4.1 DRF-JWT, 4.1.1 安装, 4.1.2 使用, 4.1.3 测试, 4.1.4 DRF-JWT开发, 5 Django DRF序列化器 Serializer, 5.1 定义序列化器, 常用字段类型, 选项参数, 通用参数, 5.2 创建Serializer对象, 5.3 序列化, 5.3.1 基本使用, 5.4 反序列化, 反序列化-保存数据, 模型类序列化器, 定义, 指定字段, 添加额外参数框架入门与技术无关它是一种软件架构风格是的简称中文翻译为表征状态转移从资源的角度类审视整个网络它将分布在网络中某个节点的资源通过进行标识客户端应用通过来获取资源的表征获得这些表征致使这些应用转变状态所有的数据不管是通过网络获取的还是操作增删改查的数据都是资源将一切数据视为资源是区别与其他架构风格的最本质属性对于这种面向资源的架构风格有人提出一种全新的结构理念即面向资源架构接口和规范接口规定了前端和后端交互规则的连接也就是前后端交互的媒介为什么要有规范为了在团队中达成共识防止个人习惯差异引起的混乱需要一个大家都认可的规范减少合作成本接口文档编写接口的用户使用方法数据格式等等可以使用书写或者使用工具自动生成规范必须通过来传输数据必须标志接口中要提现接口版本通过请求方法的不通来区分操作查询新增和提交数据修改数据局部修改数据删除数据请求路径中带过滤在后面带参数金返回响应数据中携带响应状态码返回数据中携带错误信息错误信息针对不同操作返回数据符合以下规范返回资源对象的列表返回为的单个资源对象返回新生成的资源对象返回修改后的完整的资源对象返回修改后端完整的资源对象返回一个空文档返回结果中写在资源连接介绍与安装介绍简称可以更方便的使用写出符合规范的接口缩减编写接口的代码是一个建立在基础之上的应用开发框架的一个可以快速的开发接口应用在中提供了序列化器的定义可以帮助我们简化序列化与反序列化的过程不仅如此还提供丰富的类视图扩展类视图集来简化视图的编写工作还提供了认证权限限流过滤分页接口文档等功能支持提供了一个的可视化界面来方便查看测试接口官方文档安装配置在中添加中书写模型类创建好模型类执行数据库迁移命令新建一个序列化类该文件也自己创建指明该序列化器处理的数据字段从模型类参考生成指明该序列化器包含模型类中的哪些字段指明包含所有字段视图类指明该视图在进行序列化或反序列化时使用的序列化器指明该视图集在查询数据时使用的查询集编写路由用来处理视图的路由器在路由器中注册视图集将路由器中的所有路由信息拼接到中的路由列表中启动项目开始测试添加一本书获取图书功能组件认证认证配置在配置文件中配置全局默认的认证方案基本认证认证也可以在每个视图中通过设置属性来设置认证失败会有两种可能的返回值未认证权限被禁止权限权限控制可以限制用户对于视图的访问和对于具体数据对象的访问在执行视图的方法前会先进行视图访问权限的判断在通过获取具体对象时会进行模型对象访问权限的判断认证使用可以在配置文件中设置默认的权限管理类如如果未指明则采用如下默认配置也可以在具体的视图中通过属性来设置如提供的权限允许所有用户仅通过认证的用户仅管理员用户已经登陆认证的用户可以对数据进行增删改操作没有登陆认证的只能查看数据案例自定义权限如需自定义权限需继承父类并实现以下两个任何一个方法或全部是否可以访问视图表示当前视图对象是否可以访问数据对象表示当前视图为数据对象案例控制对对象的访问权限此案例决绝所有对对象的访问限流限流介绍可以对接口访问的频次进行限制以减轻服务器压力一般用于付费购买次数投票等场景使用限流使用可以在配置文件中使用和进行全局配置可以使用或来指明周期也可以在具体视图中通过属性来配置如可选限流类限制所有匿名未认证用户使用区分用户使用来设置频次限制认证用户使用来区分使用来设置频次限制用户对于每个视图的访问频次使用或例如案例过滤基本用法对于列表数据可能需求根据字典及逆行过滤我们可以通过添加扩展来增强支持从数据库中查询数据的过滤在配置文件中增加过滤后端的设置需要注册应用在视图中添加属性指定可以过滤的字段西游记排序对于列表数据提供了过滤器来帮助我们快速指明数据按照指定字段进行排序用法在类视图中设置使用过滤器会在请求的查询字符串参数中检查是否包含了参数如果包含了参数则按照参数指明的排序字段对数据集进行排序前端可以传递的参数的可选字段值需要在中指明示例分页基本用法提供了分页的支持我们可以在配置文件中设置全局的分页方式如每页数目也可以通过自定义类来未视图添加不通分页行为在视图中通过属性来指明注意如果在视图内关闭分页功能可以按照下面的代码进行设置可选分页器前端访问网址形式可以在子类中定义的属性每页数目前端发送的页数关键字名默认为前端发送的每页数目关键字名默认为前端最多能设置的每页数量前端访问网址形式可以在子类中定义的属性默认限制默认值与设置一直参数名默认参数名默认最大限制默认异常处理提供了异常处理我们可以自定义异常处理函数先调用默认的异常处理方法获得标准错误响应对象在此处补充自定义的异常处理在配置文件中声明自定义的异常处理如果未声明会采用默认的方式如下例如补充上处理关于数据库的异常服务器内部错误定义的异常所有异常的父类解析错误认证失败尚未认证权限决绝未找到请求方式不支持要获取的数据格式不支持超过限流次数校验失败自动生成接口文档可以自动帮助我们生成接口文档接口文档以网页的方式呈现自动接口文档能生成的是继承自及其子类的视图安装依赖设置接口文档访问路径在总路由中添加接口文档路径文档路由对应的视图配置为参数为接口文档网站的标题站点页面标题需要在配置文件中指定的配置文档描述说明的定义位置单一方法的视图可直接使用类视图的文档字符串如返回所有图书信息包含多个方法的视图在类视图的文档字符串中分开方法定义如返回所有图书信息新建图书对于视图集仍在类视图的文档字符串中封开定义但是应使用名称区分如返回图书列表数据返回图书详情数据返回最新的图书数据修改图书的阅读量访问接口文档网页视图集中的名称在接口文档网站中叫做参数的需要在模型类或序列化器类的字段中以选项定义如阅读量阅读量或阅读量视图家族提供的视图的主要作用控制序列化器的执行检验保存转换数据控制数据库查询的执行两个视图基类和是提供的所有视图的基类继承自的父类与的不同之处在于传入到视图方法中的是的对象而不是的对象视图方法可以返回的对象视图会为响应数据设置符合前端要求的格式任何异常都会被捕获到并且处理成合适的响应信息在进行分发前会对请求进行身份认证权限检查流量控制支持定义的属性列表或元祖身份认证类列表或元祖权限检查类列表或元祖流量控制类在中仍以常规的类视图定义方法来实现或者其他请求方式的方法例如继承自主要增加了操作序列化器和数据库查询的方法作用是为下面扩展类的执行提供方法支持通常在使用时可搭配一个或多个扩展类提供的关于序列化器使用的属性与方法属性指明视图使用的序列化器方法当出现一个视图类中调用多个序列化器时那么可以通过条件来判断在方法中通过返回不同的序列化器类名就可以让视图方法执行不同的序列化器对象了返回序列化器类默认返回可以重写例如返回序列化器对象主要用来提供给扩展类使用如果我们在视图中想要获取序列化器对象也可以直接调用此方法注意该方法在提供序列化器对象的时候会向序列化器对象的属性补充三个数据这三个数据对象可以在定义序列化器时使用当前视图的请求对象当前请求的类视图对象当前请求期望返回的数据格式提供的关于数据库查询的属性与方法属性指明使用的数据查询集方法返回视图使用的查询集主要用来提供给扩展类使用是列表视图与详情视图获取数据的基础默认返回属性可以重写例如返回详情视图所需的模型类数据对象主要用来提供给扩展类使用在视图中可以调用该方法获取详情信息的模型类对象若详情访问的模型类对象不存在会返回该方法会默认使用提供的方法检查当前对象是否有权限被访问例如方法根据参数查找中的数据对象其他可以设置的属性指明分页控制类指明过滤控制后端的请求对象传入视图的对象不再是默认的对象而是提供的扩展了类的类的对象提供了解析器在接收到请求后会自动根据指明的请求数据类型如表单等将请求数据进行解析解析为类字典对象保存到对象中返回解析之后的请求体数据类似于中标准的和属性但提供如下特性包含了解析之后的文件和非文件数据包含了对请求方式解析后的数据利用了的解析器不仅支持表单类型数据也支持数据与标准的相同只是更换了更正确的名称而已获取封装的对象注意要使用提供的请求处理对象必须在编写视图类时继承提供的视图基类的响应对象提供了一个响应类使用该类构造响应对象时响应的具体数据内容会被转换渲染器成符合前端需求的类型提供了渲染器用来根据请求头中的接收数据类型声明来自动转换响应数据到对应格式如果前端请求中未进行声明则会采用方式处理响应数据我们可以通过配置来修改默认响应格式可以在查找所有的默认配置项默认响应渲染类渲染器返回数据浏览器渲染器返回调试界面的构造方式数据不要是处理之后的数据只需传递的内建类型数据即可会使用渲染器处理不能是复杂结构的数据如的模型类对象对于这样的数据我们可以使用序列化器序列化处理后转为了字典类型再传递给参数参数说明为响应准备的序列化处理后的数据状态码默认模板名称如果使用时需指明用于存放响应头信息的字典响应数据的通常此参数无需传递会根据前端所需类型数据来设置该参数对象的状态码为了方便设置状态码在模块中提供了常用状态码的常量信息告知成功重定向客户端错误服务器错误视图类源码解析类的源码解析类核心代码在和方法中其中是类方法只能通过类调用不能通过对象调用它是类视图的入口点注意这里调用的时候是通过类名调用的其中方法主要执行逻辑的执行结果是函数内存地址这个函数的内存地址请求来了路由匹配成功会执行这个函数参数检查参数名不能是指定的方法名参数名必须是类已有属性视图处理函数实例化当前类的对象方法派发返回视图函数整个方法是一个装饰器函数它返回内部函数所以执行其实就是内部函数执行内部函数主要逻辑就是相应的方法方法是实例函数它的主要代码你是什么请求就会执行视图类中请求名字的方法检查请求方法是不是在中包含包括八种方法不在调用报错调用和请求方法同名的实例方法处理用户请求实例方法需要用户自己定义总结主要完成请求方法的派发调用视图类对应实例方法处理用户请求所有用户需要定义和请求方法同名的实例方法完成功能所以一般的模块写法是所以的本质上来说就是源码解析源码如果他是的一个实例翻译不要直接计算属性因为结果将被缓存并在请求之间重用请改用或调用强制性把属性拿过来该走这里了调用父类的父类的核心是跳转到豁免检测返回函数里面套函数这个一个装饰器源码源代码代码步骤记录各个参数加载各种中间件根据得到的请求方法去处理或处理异常最后统一处理跳转看一看再跳一跳根据请求方法名字去处理异常处理机制统一处理源码解析上下文构建了一个新的源码步骤获取格式化后缀设置并执行内容协商设置并进行决策版本确定版本执行认证重点检查权限检查限流获取格式化的后缀设置内容协商并存储请求中已接受的信息执行设置决策版本执行确定版本执行认证检查权限检查限流源码解析继承自也就是在基础上再做了一层封装类属性是用来控制视图返回给前端的数据如果没什么逻辑可以直接写在视图的类属性中如果逻辑比较复杂也可以重写方法用来返回一个对象如果重写了那么以后获取的时候就需要通过调用方法因为这个属性只会调用一次以后所有的请求都是使用他的缓存用来验证和序列化反序列化数据的也是可以通过直接设置这个属性也可以通过重写来实现在检索的时候根据什么参数进行检索默认是也就是主键在检索的中的参数名称默认没有设置跟保持一致用于过滤查询集的过滤器后端类的列表默认值与设置的值相同当分页列出结果时应使用的分页类默认值与设置的值相同即方法默认是返回数据库全部数据如果想返回其他数据需要自定义断言是否不为定义属性获取父类的如果父类没有定义类属性那么默认值就是就会报上面断言的错误如果是对象那么返回全部内容如果不是那么直接返回该方法是用于在数据检索通过查找的时候返回一条数据的查找过滤的条件默认是可能会引发权限被拒绝返回应该用于验证和反序列化输入以及序列化输出的序列化器实例返回用于序列化的类默认使用如果您需要根据传入请求提供不同的序列化您可能需要重写它个视图扩展类作用提供了几种后端视图对数据资源进行曾删改查处理流程的实现如果需要编写的视图属于这五种则视图可以通过继承相应的扩展类来复用代码减少自己编写的代码量这五个扩展类需要搭配父类因为五个扩展类的实现需要调用提供的序列化器与数据库查询的方法列表视图扩展类提供方法快速实现列表视图返回状态码该的方法会对数据进行过滤和分页源代码过滤分页序列化例如创建视图扩展类提供方法快速实现创建资源的视图成功返回状态码如果序列化器对前端发送的数据验证失败返回错误源代码获取序列化器验证保存详情视图扩展类提供方法可以快速实现返回一个存在的数据对象如果存在返回否则返回源代码获取对象会检查对象的权限序列化例如更新视图扩展类提供方法可以快速实现更新一个存在的数据对象同时也提供方法可以实现局部更新成功返回序列化器校验数据失败时返回错误源代码删除视图扩展类提供方法可以快速实现删除一个存在的数据对象成功返回不存在返回源代码几个子类视图提供方法继承自提供方法继承自提供方法继承自提供方法继承自提供和方法继承自提供方法继承自提供方法继承自视图集为了让视图代码变得更加简短让操作同一个模型的视图方法写在一个视图类中提供了视图集视图集允许开发者自定义类视图方法名视图集允许一个类分配多个不同的路由常用视图集父类继承自与作用也与基本类似提供了身份认证权限校验流量管理等主要通过继承来实现在调用时传入字典如的映射处理工作在中没有提供任何动作方法需要我们自己实现方法使用通常并不方便因为等方法都需要自己编写而这些方法与前面讲过的扩展类提供的方法同名所以我们可以通过继承扩展类来复用这些方法而无需自己编写但是扩展类依赖与所以还需要继承就帮助我们完成了这样的继承工作继承自与在实现了调用时传入字典如的映射处理工作的同时还提供了提供的基础方法可以直接搭配扩展类使用举例的定义继承自同时包括了继承自同时包括了视图集中定义附加动作在视图集中除了上述默认的方法动作外还可以添加自定义动作举例返回最新的图书信息修改图书的阅读量数据的定义属性获取评论值最多的条数据操作数据库获取本次请求的视图方法名通过路由访问到当前方法中可以看到本次的就是请求的方法名路由对于视图集我们除了可以自己手动指明请求方式与动作之间的对应关系外还可以使用来帮助我们快速实现路由信息提供了两个使用方法创建对象并注册视图集例如该视图集的路由前缀视图集路由名称的前缀如上述代码会形成的路由如下添加路由数据可以有两种方式或视图集中附加的声明在视图集中如果想要让自动帮助我们为自定义的动作生成路由信息需要使用装饰器以装饰器装饰的方法名会作为动作名与等同装饰器可以接收两个参数声明该对应的请求方式列表传递声明该的路径是否与单一资源对应及是否是方法名表示路径格式是方法名表示路径格式是方法名例如为表示路径名格式应该为返回最新的图书信息为表示路径名格式应该为修改图书的阅读量数据由路由器自动为此视图集自定义方法形成的路由会是如下内容路由形成的方法与的区别是会多附带一个默认的根视图返回一个包含所有列表视图的超链接响应数据令牌是一个开放标准它定义了一种紧凑的自包含的方式用于在各方之间以对象安全地传输信息此信息可以验证和信任因为它是数字签名的可以使用秘密使用算法或使用或的公钥私钥对进行签名通过形式作为应用中的令牌用于在各方之间安全地将信息作为对象传输在数据传输过程中还可以完成数据加密签名等相关处理作用授权一旦用户登录每个后续请求将包括从而允许用户访问该令牌允许的路由服务和资源它的开销很小并且可以在不同的域中使用如单点登录信息交换在各方之间安全地传输信息可进行签名如使用公钥私钥对因此可确保发件人由于签名是使用标头和有效负载计算的因此还可验证内容是否被篡改头部载荷头部载荷密钥是可逆的算法是不可逆的算法密钥是固定的字符串保存在服务器官网安装使用测试案例需要提前准备开发配置信息到中过期时间自定义认证结果见下方序列化和自定义序列化自己创建自定义基于的全局认证自己创建字段是必须的签名过期非法用户全局启用认证模块自带的认证模块局部启用禁用任何一个类首行设置局部禁用局部启用自定义代码登录配置自定义登录手动签发序列化器定义序列化器中的使用类来定义须继承自例如我们已有了一个数据库模型类名称发布日期阅读量评论量图片我们想为这个模型类提供一个序列化器可以定义如下图书数据序列化器名称发布日期阅读量评论量图片注意不是只能为数据库模型类定义也可以为非数据库模型类的数据定义是独立于数据库之外的存在常用字段类型常用字段类型字段字段构造方式正则字段验证正则模式如如如如最多位数小数点位置与的用法相同选项参数选项参数参数名称作用最大长度最小长度是否允许为空是否截断空白字符最小值最大值通用参数参数名称说明表明该字段仅用于序列化输出默认表明该字段仅用于反序列化输入默认表明该字段在反序列化时必须输入默认反序列化时使用的默认值表明该字段是否允许传入默认该字段使用的验证器包含错误编号与错误信息的字典用于展示页面时显示的字段名称用于展示页面时显示的字段帮助提示信息创建对象序列化器有四大功能反序列化把请求中参数字典模型对象请求参数校验保存和修改模型对象数据库序列化把模型对象字典由来完成定义好类后就可以创建对象了的构造方法为说明用于序列化时将模型类对象传入参数用于反序列化时将要被反序列化的数据传入参数除了和参数外在构造对象时还可通过参数额外添加数据如通过参数附加的数据可以通过对象的属性获取使用序列化器的时候一定要注意序列化器声明了以后不会自动执行需要我们在视图中进行调用才可以序列化器无法直接接收数据需要我们在视图中创建序列化器对象时把使用的数据传递过来序列化器的字段声明类似于我们前面使用过的表单系统开发时序列化器会帮我们把模型数据转换成字典提供的视图会帮我们把字典转换成或者把客户端发送过来的数据转换字典序列化器的使用分两个阶段在客户端请求时使用序列化器可以完成对数据的反序列化在服务器响应时使用序列化器可以完成对数据的序列化序列化基本使用先查询出一个图书对象构造序列化对象获取序列化数据通过属性可以获取序列化后的数据天龙八部如果要被序列化的是包含多条数据的查询集可以通过添加参数补充说明天龙八部笑傲江湖雪山飞狐西游记反序列化进行反序列化之前必须先进行数据验证使用序列化器进行反序列化时需要对数据进行验证后才能获取验证成功的数据或保存成模型类对象在获取反序列化的数据前必须调用方法进行验证验证成功返回否则返回验证失败可以通过序列化器对象的属性获取错误信息返回字典包含了字段和字段的错误如果是非字段错误可以通过修改配置中的来控制错误字典中的键名验证成功可以通过序列化器对象的属性获取数据在定义序列化器时指明每个字段的序列化类型和选项参数本身就是一种验证行为如我们前面定义过的图书数据序列化器名称发布日期阅读量评论量图片通过构造序列化器对象并将要反序列化的数据传递给构造参数进而进行验证返回方法还可以在验证失败时抛出异常可以通过传递参数开启接收到此异常会向前端返回响应字段名对字典进行验证如图书数据序列化器图书不是关于的测试图书不是关于的在序列化器中需要同时对多个字段进行比较验证时可以定义方法来验证如阅读量小于评论量在字段中添加选项参数也可以补充验证行为如图书不是关于的图书数据序列化器名称发布日期阅读量评论量图片测试图书不是关于的反序列化保存数据前面的验证数据成功后我们可以使用序列化器来完成数据反序列化的过程这个过程可以把数据转成模型类对象可以通过实现和两个方法来实现图书数据序列化器新建更新为要更新的对象实例如果需要在返回数据对象的时候也将数据保存到数据库中则可以进行如下修改图书数据序列化器新建更新为要更新的对象实例实现了上述两个方法后在反序列化数据的时候就可以通过方法返回一个数据对象实例了如果创建序列化器对象的时候没有传递实例则调用方法的时候被调用相反如果传递了实例则调用方法的时候被调用封神演义封神演义倚天剑倚天剑倚天剑说明在对序列化器进行保存时可以额外传递数据这些数据可以在和中的参数获取到是中记录当前登录用户的模型对象默认序列化器必须传递所有的字段否则会抛出验证异常但是我们可以使用参数来允许部分字段更新模型类序列化器如果我们想要使用序列化器对应的是的模型类为我们提供了模型类序列化器来帮助我们快速创建一个类与常规的相同但提供了基于模型类自动生成一系列字段基于模型类自动为生成比如包含默认的和的实现定义比如我们创建一个图书数据序列化器指明参照哪个模型类指明为模型类的哪些字段生成我们可以在中查看自动生成的的具体实现名称发布日期阅读量评论量图片指定字段使用来明确字段表名包含所有字段也可以写明具体哪些字段如图书数据序列化器使用可以明确排序掉哪些字段图书数据序列化器显示指明字段如指明只读字段可以通过指明只读字段既仅用于序列化输出的字段图书数据序列化器添加额外参数我们可以使用参数为添加或修改原有的选项参数图书数据序列化器名称发布日期阅读量评论量',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-11-09 16:59:00',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/custom/css/icon.css"><link rel="stylesheet" href="/custom/css/header.css"><link rel="stylesheet" href="/custom/css/bg.css"><link rel="stylesheet" href="/custom/css/card_tuijian.css"><link rel="stylesheet" href="/custom/css/contact_info.css"><span id="fps"></span><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/avatar/avatar01.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">线路切换</div><div class="back-menu-list"><a class="back-menu-item" href="https://ync.aqyync.top/" title="vercel线路"><img class="back-menu-item-icon" src="/img/logo.png" alt="vercel线路"/><span class="back-menu-item-text">vercel线路</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="http://119.29.59.206:8000/" title="tx云线路"><img class="back-menu-item-icon" src="/img/logo.png" alt="tx云线路"/><span class="back-menu-item-text">tx云线路</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客2</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.aqyync.top/" title="vercel线路"><img class="back-menu-item-icon" src="/img/logo.png" alt="vercel线路"/><span class="back-menu-item-text">vercel线路</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cnblogs.com/yncaqy" title="博客园"><img class="back-menu-item-icon" src="https://raw.githubusercontent.com/yncaqy/pic_bed/main/tj/favicon.svg" alt="博客园"/><span class="back-menu-item-text">博客园</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="http://119.29.59.206:5244/" title="Alist"><img class="back-menu-item-icon" src="https://cdn.jsdelivr.net/gh/alist-org/logo@main/logo.svg" alt="Alist"/><span class="back-menu-item-text">Alist</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="http://119.29.59.206/" title="图床"><img class="back-menu-item-icon" src="https://raw.githubusercontent.com/yncaqy/pic_bed/main/tj/20241110220610.png" alt="图床"/><span class="back-menu-item-text">图床</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="http://119.29.59.206/thumbnail/index.html" title="视频缩略图生成"><img class="back-menu-item-icon" src="https://artplayer.org/assets/img/logo.png" alt="视频缩略图生成"/><span class="back-menu-item-text">视频缩略图生成</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">我的主页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://home.aqyync.top/" title="月念尘的主页"><img class="back-menu-item-icon" src="https://raw.githubusercontent.com/yncaqy/pic_bed/main/tj/logo.png" alt="月念尘的主页"/><span class="back-menu-item-text">月念尘的主页</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">YNCAQY</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)" rel="external nofollow noreferrer">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=6977860977&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 剑气长城</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="background_change"><a class="site-page" onclick="toggleWinbox()" title="切换背景" href="javascript:void(0);" rel="external nofollow noreferrer" data-pjax-state="data-pjax-state"><i class="anzhiyufont anzhiyu-icon-instagram"></i></a></div><div class="nav-button" id="darkmode"><a class="site-page" title="切换模式" href="javascript:void(0);" rel="external nofollow noreferrer" onclick="switchDarkMode()"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></a></div><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/img/reward/wechat2.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="/img/reward/wechat2.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/reward/alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="/img/reward/alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/DRF%E6%A1%86%E6%9E%B6/" style="font-size: 1.05rem;">DRF框架<sup>1</sup></a><a href="/tags/linux%E5%A4%87%E5%BF%98/" style="font-size: 1.05rem;">linux备忘<sup>1</sup></a><a href="/tags/markdown/" style="font-size: 1.05rem;">markdown<sup>1</sup></a><a href="/tags/nginx/" style="font-size: 1.05rem;">nginx<sup>1</sup></a><a href="/tags/test/" style="font-size: 1.05rem;">test<sup>2</sup></a><a href="/tags/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/" style="font-size: 1.05rem;">线性代数<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">四月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);" rel="external nofollow noreferrer"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/" itemprop="url">后端</a><i class="anzhiyufont anzhiyu-icon-angle-right post-meta-separator"></i><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/python/" itemprop="url">python</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/DRF%E6%A1%86%E6%9E%B6/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>DRF框架</span></a></span></div></div><h1 class="post-title" itemprop="name headline">DRF框架</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-04-14T08:50:34.000Z" title="发表于 2023-04-14 16:50:34">2023-04-14</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-11-09T08:59:00.193Z" title="更新于 2024-11-09 16:59:00">2024-11-09</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">13.8k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>57分钟</span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为广州"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>广州</span></div></div></div><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="/img/article_cover/DRF%E6%A1%86%E6%9E%B6.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><div class="post-ai-description"><div class="ai-title"><i class="anzhiyufont anzhiyu-icon-bilibili"></i><div class="ai-title-text">AI-摘要</div><div id="ai-Toggle">切换</div><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i><i class="anzhiyufont anzhiyu-icon-circle-dot" title="朗读摘要"></i><div id="ai-tag">Tianli GPT</div></div><div class="ai-explanation">AI初始化中...</div><div class="ai-btn-box"><div class="ai-btn-item">介绍自己 🙈</div><div class="ai-btn-item">生成本文简介 👋</div><div class="ai-btn-item">推荐相关文章 📖</div><div class="ai-btn-item">前往主页 🏠</div><div class="ai-btn-item" id="go-tianli-blog">前往爱发电购买</div></div><script data-pjax src="/js/anzhiyu/ai_abstract.js"></script></div><article class="post-content" id="article-container" itemscope itemtype="https://ync.aqyync.top/1885882428/"><header><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/" itemprop="url">后端</a><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/python/" itemprop="url">python</a><a href="/tags/DRF%E6%A1%86%E6%9E%B6/" tabindex="-1" itemprop="url">DRF框架</a><h1 id="CrawlerTitle" itemprop="name headline">DRF框架</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">月念尘</span><time itemprop="dateCreated datePublished" datetime="2023-04-14T08:50:34.000Z" title="发表于 2023-04-14 16:50:34">2023-04-14</time><time itemprop="dateCreated datePublished" datetime="2024-11-09T08:59:00.193Z" title="更新于 2024-11-09 16:59:00">2024-11-09</time></header><h4 id="DRF框架"><a href="#DRF框架" class="headerlink" title="DRF框架"></a>DRF框架</h4><h2 id="1-DRF入门"><a href="#1-DRF入门" class="headerlink" title="1 DRF入门"></a>1 DRF入门</h2><h3 id="1-1-RESTful"><a href="#1-1-RESTful" class="headerlink" title="1.1 RESTful"></a>1.1 RESTful</h3><ul>
<li>REST与技术无关，它是一种 <strong>软件架构风格</strong> ，REST是Representational State Transfer的简称，中文翻译为“ <strong>表征状态转移</strong> ”</li>
<li>REST从<strong>资源的角度</strong>类审视整个网络，它将分布在网络中某个节点的 <strong>资源通过URL进行标识</strong> ，客户端应用<strong>通过URL来获取资源</strong>的表征，获得这些表征致使这些应用转变状态</li>
<li>所有的数据，不管是通过网络获取的还是操作(增删改查)的数据，都是资源，<strong>将一切数据视为资源</strong>是REST区别与其他架构风格的最本质属性</li>
<li>对于REST这种面向资源的架构风格，有人提出一种全新的结构理念，即： <strong>面向资源架构</strong> （ROA：Resource Oriented Architecture）</li>
</ul>
<h3 id="1-2-API接口和-RESTful-API规范"><a href="#1-2-API接口和-RESTful-API规范" class="headerlink" title="1.2 API接口和 RESTful API规范"></a>1.2 API接口和 RESTful API规范</h3><p>1.2.1 API接口</p>
<ul>
<li>规定了前端和后端交互规则的URL连接，也就是前后端交互的媒介</li>
</ul>
<p>1.2.2 为什么要有规范</p>
<ul>
<li>为了在团队中达成共识、防止个人习惯差异引起的混乱</li>
<li>需要一个大家都认可的规范，减少合作成本</li>
</ul>
<p>1.2.3 API接口文档</p>
<ul>
<li>编写接口的用户、使用方法、数据格式等等</li>
<li>可以使用书写、或者使用工具自动生成（coreapi,swagger)</li>
</ul>
<p>1.2.4 RESTful API规范</p>
<ul>
<li>必须通过http来传输数据</li>
<li>必须api标志：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://localhost:8080/api/xxx">http://localhost:8080/api/xxx</a></li>
<li>接口中要提现接口版本：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://localhost:8080/api/v1/books">http://localhost:8080/api/v1/books</a></li>
<li>通过请求方法的不通来区分操作：<ul>
<li>查询：GET</li>
<li>POST：新增和提交数据</li>
<li>PUT：修改数据</li>
<li>PATCH：局部修改数据</li>
<li>DELETE：删除数据</li>
</ul>
</li>
<li>请求路径中带过滤，在URL后面带参数：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://api.example.com/v1/?name=%27%E9%87%91%27&order=asc">https://api.example.com/v1/?name=&#39;金&#39;&amp;order=asc</a></li>
<li>返回响应数据中携带响应状态码</li>
<li>返回数据中携带错误信息：{error : ‘错误信息’}</li>
<li>针对不同操作，返回数据符合以下规范：<ul>
<li>GET &#x2F;books ：返回资源对象的列表</li>
<li>GET &#x2F;books&#x2F;1 ：返回id为1的单个资源对象</li>
<li>POST &#x2F;boos：返回新生成的资源对象</li>
<li>PUT &#x2F;books&#x2F;1：返回修改后的完整的资源对象</li>
<li>PATCH &#x2F;books&#x2F;1：返回修改后端完整的资源对象</li>
<li>DELETE &#x2F;books&#x2F;1：返回一个空文档</li>
</ul>
</li>
<li>返回结果中写在资源连接：{“name”:”zhangsan”, “url”:”<a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.xx.xx.com/xxx%22%7D">http://www.xx.xx.com/xxx&quot;}</a></li>
</ul>
<h3 id="1-3-Django-RESTful介绍与安装"><a href="#1-3-Django-RESTful介绍与安装" class="headerlink" title="1.3 Django-RESTful介绍与安装"></a>1.3 Django-RESTful介绍与安装</h3><h4 id="1-3-1-介绍"><a href="#1-3-1-介绍" class="headerlink" title="1.3.1 介绍"></a>1.3.1 介绍</h4><ul>
<li>Django rest_framework, 简称 drf, 可以更方便的使用django写出符合 RESTful 规范的接口, (缩减编写api接口的代码)</li>
</ul>
<blockquote>
<ul>
<li>Django REST framework是一个建立在Django基础之上的Web应用开发框架(Django的一个app)，可以快速的开发REST API接口应用</li>
<li>在REST framework中，提供了序列化器Serialzier的定义，可以帮助我们简化序列化与反序列化的过程</li>
<li>不仅如此，还提供丰富的类视图、扩展类、视图集来简化视图的编写工作</li>
<li>REST framework还提供了认证、权限、限流、过滤、分页、接口文档等功能支持</li>
<li>REST framework提供了一个API 的Web可视化界面来方便查看测试接口</li>
</ul>
</blockquote>
<ul>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.django-rest-framework.org/">官方文档 : https://www.django-rest-framework.org/</a></li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/encode/django-rest-framework/tree/master">GitHub : https://github.com/encode/django-rest-framework/tree/master</a></li>
</ul>
<h4 id="1-3-2-安装DRF"><a href="#1-3-2-安装DRF" class="headerlink" title="1.3.2 安装DRF"></a>1.3.2 安装DRF</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install djangorestframework</span><br></pre></td></tr></table></figure>

<h4 id="1-3-3-配置DRF"><a href="#1-3-3-配置DRF" class="headerlink" title="1.3.3 配置DRF"></a>1.3.3 配置DRF</h4><p>在settings.py中添加app</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    ...</span><br><span class="line">    &#x27;rest_framework&#x27;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>1.3.4 models.py中书写模型类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from django.db import models</span><br><span class="line">class Book(models.Model):</span><br><span class="line">    nid = models.AutoField(primary_key=True)</span><br><span class="line">    title = models.CharField(max_length=32)</span><br><span class="line">    price = models.DecimalField(max_digits=8,decimal_places=2)</span><br><span class="line">    author = models.CharField(max_length=16)</span><br><span class="line">    publish = models.CharField(max_length=16)</span><br><span class="line">    # 创建好模型类执行数据库迁移命令</span><br></pre></td></tr></table></figure>

<h4 id="1-3-4-serializer-py新建一个序列化类（该文件也自己创建）"><a href="#1-3-4-serializer-py新建一个序列化类（该文件也自己创建）" class="headerlink" title="1.3.4 serializer.py新建一个序列化类（该文件也自己创建）"></a>1.3.4 serializer.py新建一个序列化类（该文件也自己创建）</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework.serializers import ModelSerializer</span><br><span class="line">from drf_test import models</span><br><span class="line">class BookSerializers(ModelSerializer):</span><br><span class="line">    class Meta:</span><br><span class="line">        model = models.Book # 指明该序列化器处理的数据字段从模型类Book参考生成</span><br><span class="line">        fields = &quot;__all__&quot; # 指明该序列化器包含模型类中的哪些字段，’all‘指明包含所有字段</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="1-3-5-视图类"><a href="#1-3-5-视图类" class="headerlink" title="1.3.5 视图类"></a>1.3.5 视图类</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from django.shortcuts import render</span><br><span class="line">from rest_framework.viewsets import ModelViewSet</span><br><span class="line">from drf_test.serializers import BookSerializers</span><br><span class="line">from drf_test import models</span><br><span class="line"></span><br><span class="line">class BookView(ModelViewSet):</span><br><span class="line">    serializer_class = BookSerializers # 指明该视图在进行序列化或反序列化时使用的序列化器</span><br><span class="line">    queryset = models.Book.objects.all() # 指明该视图集在查询数据时使用的查询集</span><br></pre></td></tr></table></figure>

<h4 id="1-3-6-编写路由"><a href="#1-3-6-编写路由" class="headerlink" title="1.3.6 编写路由"></a>1.3.6 编写路由</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from django.contrib import admin</span><br><span class="line">from django.urls import path</span><br><span class="line">from rest_framework.routers import SimpleRouter</span><br><span class="line">from drf_test import views</span><br><span class="line">router = SimpleRouter() # 用来处理视图的路由器</span><br><span class="line">router.register(&#x27;book&#x27;,views.BookView) # 在路由器中注册视图集</span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(&#x27;admin/&#x27;, admin.site.urls),</span><br><span class="line">]</span><br><span class="line">urlpatterns += router.urls # 将路由器中的所有路由信息拼接到Django中的路由列表中</span><br></pre></td></tr></table></figure>

<h4 id="1-3-7-启动项目开始测试"><a href="#1-3-7-启动项目开始测试" class="headerlink" title="1.3.7 启动项目开始测试"></a>1.3.7 启动项目开始测试</h4><p>POST：添加一本书</p>
<p>GET：获取图书</p>
<h2 id="2-DRF功能组件"><a href="#2-DRF功能组件" class="headerlink" title="2 DRF功能组件"></a>2 DRF功能组件</h2><h3 id="2-1-认证Authentication"><a href="#2-1-认证Authentication" class="headerlink" title="2.1 认证Authentication"></a>2.1 认证Authentication</h3><h4 id="2-1-1-认证配置"><a href="#2-1-1-认证配置" class="headerlink" title="2.1.1 认证配置"></a>2.1.1 认证配置</h4><p>在配置文件中配置全局默认的认证方案：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    &#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;: (</span><br><span class="line">        &#x27;rest_framework.authentication.BasicAuthentication&#x27;,   # 基本认证</span><br><span class="line">        &#x27;rest_framework.authentication.SessionAuthentication&#x27;,  # session认证</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以在每个视图中通过设置authentication_classes属性来设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework.authentication import SessionAuthentication, BasicAuthentication</span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line"></span><br><span class="line">class ExampleView(APIView):</span><br><span class="line">    authentication_classes = (SessionAuthentication, BasicAuthentication)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>认证失败会有两种可能的返回值</p>
<ul>
<li>401 Unauthorized 未认证</li>
<li>403 Permission Denied 权限被禁止</li>
</ul>
<p>权限Permissions</p>
<p>权限控制可以限制用户对于视图的访问和对于具体数据对象的访问。</p>
<ul>
<li>在执行视图的dispatch()方法前，会先进行视图访问权限的判断</li>
<li>在通过get_object()获取具体对象时，会进行模型对象访问权限的判断</li>
</ul>
<h4 id="2-1-2-认证使用"><a href="#2-1-2-认证使用" class="headerlink" title="2.1.2 认证使用"></a>2.1.2 认证使用</h4><p>可以在配置文件中设置默认的权限管理类，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    &#x27;DEFAULT_PERMISSION_CLASSES&#x27;: (</span><br><span class="line">        &#x27;rest_framework.permissions.IsAuthenticated&#x27;,</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果未指明，则采用如下默认配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x27;DEFAULT_PERMISSION_CLASSES&#x27;: (</span><br><span class="line">   &#x27;rest_framework.permissions.AllowAny&#x27;,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>也可以在具体的视图中通过permission_casses属性来设置，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework.permissions import IsAuthenticated</span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line"></span><br><span class="line">class ExampleView(APIView):</span><br><span class="line">    permission_classes = (IsAuthenticated,)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h4 id="2-1-3-提供的权限"><a href="#2-1-3-提供的权限" class="headerlink" title="2.1.3 提供的权限"></a>2.1.3 提供的权限</h4><ul>
<li>AllowAny 允许所有用户</li>
<li>IsAuthenticated 仅通过认证的用户</li>
<li>IsAdminUser 仅管理员用户</li>
<li>IsAuthenticatedOrReadOnly 已经登陆认证的用户可以对数据进行增删改操作，没有登陆认证的只能查看数据。</li>
</ul>
<p>案例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework.authentication import SessionAuthentication</span><br><span class="line">from rest_framework.permissions import IsAuthenticated</span><br><span class="line">from rest_framework.generics import RetrieveAPIView</span><br><span class="line"></span><br><span class="line">class BookDetailView(RetrieveAPIView):</span><br><span class="line">    queryset = BookInfo.objects.all()</span><br><span class="line">    serializer_class = BookInfoSerializer</span><br><span class="line">    authentication_classes = [SessionAuthentication]</span><br><span class="line">    permission_classes = [IsAuthenticated]</span><br></pre></td></tr></table></figure>

<h4 id="2-1-4-自定义权限"><a href="#2-1-4-自定义权限" class="headerlink" title="2.1.4 自定义权限"></a>2.1.4 自定义权限</h4><p>如需自定义权限，需继承rest_framework.permissions.BasePermission父类，并实现以下两个任何一个方法或全部</p>
<ul>
<li><code>.has_permission(self, request, view)</code><br>是否可以访问视图， view表示当前视图对象</li>
<li><code>.has_object_permission(self, request, view, obj)</code><br>是否可以访问数据对象， view表示当前视图， obj为数据对象</li>
</ul>
<p>案例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class MyPermission(BasePermission):</span><br><span class="line">    def has_object_permission(self, request, view, obj):</span><br><span class="line">        &quot;&quot;&quot;控制对obj对象的访问权限，此案例决绝所有对对象的访问&quot;&quot;&quot;</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line">class BookInfoViewSet(ModelViewSet):</span><br><span class="line">    queryset = BookInfo.objects.all()</span><br><span class="line">    serializer_class = BookInfoSerializer</span><br><span class="line">    permission_classes = [IsAuthenticated, MyPermission]</span><br></pre></td></tr></table></figure>

<h3 id="2-2-限流Throttling"><a href="#2-2-限流Throttling" class="headerlink" title="2.2 限流Throttling"></a>2.2 限流Throttling</h3><h4 id="2-2-1-限流介绍"><a href="#2-2-1-限流介绍" class="headerlink" title="2.2.1 限流介绍"></a>2.2.1 限流介绍</h4><p>可以对接口访问的频次进行限制，以减轻服务器压力。</p>
<p>一般用于付费购买次数,投票等场景使用.</p>
<h4 id="2-2-2-限流使用"><a href="#2-2-2-限流使用" class="headerlink" title="2.2.2 限流使用"></a>2.2.2 限流使用</h4><p>可以在配置文件中，使用DEFAULT_THROTTLE_CLASSES和DEFAULT_THROTTLE_RATES进行全局配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    &#x27;DEFAULT_THROTTLE_CLASSES&#x27;: (</span><br><span class="line">        &#x27;rest_framework.throttling.AnonRateThrottle&#x27;,</span><br><span class="line">        &#x27;rest_framework.throttling.UserRateThrottle&#x27;</span><br><span class="line">    ),</span><br><span class="line">    &#x27;DEFAULT_THROTTLE_RATES&#x27;: &#123;</span><br><span class="line">        &#x27;anon&#x27;: &#x27;100/day&#x27;,</span><br><span class="line">        &#x27;user&#x27;: &#x27;1000/day&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>DEFAULT_THROTTLE_RATES</code> 可以使用 <code>second</code>, <code>minute</code>, <code>hour</code> 或 <code>day</code>来指明周期。</p>
<p>也可以在具体视图中，通过throttle_classes属性来配置，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework.throttling import UserRateThrottle</span><br><span class="line">from rest_framework.views import APIView</span><br><span class="line"></span><br><span class="line">class ExampleView(APIView):</span><br><span class="line">    throttle_classes = (UserRateThrottle,)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h4 id="2-2-3-可选限流类"><a href="#2-2-3-可选限流类" class="headerlink" title="2.2.3 可选限流类"></a>2.2.3 可选限流类</h4><p>1） AnonRateThrottle</p>
<p>限制所有匿名未认证用户，使用IP区分用户。</p>
<p>使用 <code>DEFAULT_THROTTLE_RATES[&#39;anon&#39;]</code> 来设置频次</p>
<p>2）UserRateThrottle</p>
<p>限制认证用户，使用User id 来区分。</p>
<p>使用 <code>DEFAULT_THROTTLE_RATES[&#39;user&#39;]</code> 来设置频次</p>
<p>3）ScopedRateThrottle</p>
<p>限制用户对于每个视图的访问频次，使用ip或user id。</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">class ContactListView(APIView):</span><br><span class="line">    throttle_scope = &#x27;contacts&#x27;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">class ContactDetailView(APIView):</span><br><span class="line">    throttle_scope = &#x27;contacts&#x27;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">class UploadView(APIView):</span><br><span class="line">    throttle_scope = &#x27;uploads&#x27;</span><br><span class="line">    ...</span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    &#x27;DEFAULT_THROTTLE_CLASSES&#x27;: (</span><br><span class="line">        &#x27;rest_framework.throttling.ScopedRateThrottle&#x27;,</span><br><span class="line">    ),</span><br><span class="line">    &#x27;DEFAULT_THROTTLE_RATES&#x27;: &#123;</span><br><span class="line">        &#x27;contacts&#x27;: &#x27;1000/day&#x27;,</span><br><span class="line">        &#x27;uploads&#x27;: &#x27;20/day&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-4-案例"><a href="#2-2-4-案例" class="headerlink" title="2.2.4 案例"></a>2.2.4 案例</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework.authentication import SessionAuthentication</span><br><span class="line">from rest_framework.permissions import IsAuthenticated</span><br><span class="line">from rest_framework.generics import RetrieveAPIView</span><br><span class="line">from rest_framework.throttling import UserRateThrottle</span><br><span class="line"></span><br><span class="line">class BookDetailView(RetrieveAPIView):</span><br><span class="line">    queryset = BookInfo.objects.all()</span><br><span class="line">    serializer_class = BookInfoSerializer</span><br><span class="line">    authentication_classes = [SessionAuthentication]</span><br><span class="line">    permission_classes = [IsAuthenticated]</span><br><span class="line">    throttle_classes = (UserRateThrottle,)</span><br></pre></td></tr></table></figure>

<h3 id="2-3-过滤Filtering"><a href="#2-3-过滤Filtering" class="headerlink" title="2.3 过滤Filtering"></a>2.3 过滤Filtering</h3><h4 id="2-3-1-基本用法"><a href="#2-3-1-基本用法" class="headerlink" title="2.3.1 基本用法"></a>2.3.1 基本用法</h4><p>对于列表数据，可能需求根据字典及逆行过滤，我们可以通过添加django-filter扩展来增强支持。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pip install django-filter</span><br><span class="line"></span><br><span class="line"># 从数据库中查询数据的过滤</span><br><span class="line">select * from t_emp where name=&#x27;zs&#x27; and sal=2000</span><br></pre></td></tr></table></figure>

<p>在配置文件中增加过滤后端的设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    ...</span><br><span class="line">    &#x27;django_filters&#x27;,  # 需要注册应用，</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    ...</span><br><span class="line">    &#x27;DEFAULT_FILTER_BACKENDS&#x27;: (&#x27;django_filters.rest_framework.DjangoFilterBackend&#x27;,)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在视图中添加filter_fields属性，指定可以过滤的字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class BookListView(ListAPIView):</span><br><span class="line">    queryset = BookInfo.objects.all()</span><br><span class="line">    serializer_class = BookInfoSerializer</span><br><span class="line">    filter_fields = (&#x27;btitle&#x27;, &#x27;bread&#x27;)</span><br><span class="line"></span><br><span class="line"># 127.0.0.1:8000/books/?btitle=西游记</span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-排序"><a href="#2-3-2-排序" class="headerlink" title="2.3.2 排序"></a>2.3.2 排序</h4><p>对于列表数据，REST framework提供了OrderingFileter过滤器来帮助我们快速指明数据按照指定字段进行排序</p>
<p>用法</p>
<p>在类视图中设置filter_backends，使用 <code>rest_framework.filters.OrderingFilter</code>过滤器，REST framework会在请求的查询字符串参数中检查是否包含了ordering参数，如果包含了ordering参数，则按照ordering参数指明的排序字段对数据集进行排序。</p>
<p>前端可以传递的ordering参数的可选字段值需要在ordering_fields中指明。</p>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class BookListView(ListAPIView):</span><br><span class="line">    queryset = BookInfo.objects.all()</span><br><span class="line">    serializer_class = BookInfoSerializer</span><br><span class="line">    filter_backends = [OrderingFilter]</span><br><span class="line">    ordering_fields = (&#x27;id&#x27;, &#x27;bread&#x27;, &#x27;bpub_date&#x27;)</span><br><span class="line"></span><br><span class="line"># 127.0.0.1:8000/books/?ordering=-bread</span><br></pre></td></tr></table></figure>

<h3 id="2-4-分页"><a href="#2-4-分页" class="headerlink" title="2.4 分页"></a>2.4 分页</h3><h4 id="2-4-1-基本用法"><a href="#2-4-1-基本用法" class="headerlink" title="2.4.1 基本用法"></a>2.4.1 基本用法</h4><p>REST framework提供了分页的支持。</p>
<p>我们可以在配置文件中设置全局的分页方式，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    &#x27;DEFAULT_PAGINATION_CLASS&#x27;:  &#x27;rest_framework.pagination.PageNumberPagination&#x27;,</span><br><span class="line">    &#x27;PAGE_SIZE&#x27;: 100  # 每页数目</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以通过自定义Pagination类，来未视图添加不通分页行为。在视图中通过Pagination_clas属性来指明</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class LargeResultsSetPagination(PageNumberPagination):</span><br><span class="line">    page_size = 1000</span><br><span class="line">    page_size_query_param = &#x27;page_size&#x27;</span><br><span class="line">    max_page_size = 10000</span><br><span class="line">class BookDetailView(RetrieveAPIView):</span><br><span class="line">    queryset = BookInfo.objects.all()</span><br><span class="line">    serializer_class = BookInfoSerializer</span><br><span class="line">    pagination_class = LargeResultsSetPagination</span><br></pre></td></tr></table></figure>

<p>注意：如果在视图内关闭分页功能，可以按照下面的代码进行设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pagination_class = None</span><br></pre></td></tr></table></figure>

<h4 id="2-4-2-可选分页器"><a href="#2-4-2-可选分页器" class="headerlink" title="2.4.2 可选分页器"></a>2.4.2 可选分页器</h4><p>1） <strong>PageNumberPagination</strong></p>
<p>前端访问网址形式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET  http://api.example.org/books/?page=4</span><br></pre></td></tr></table></figure>

<p>可以在子类中定义的属性：</p>
<ul>
<li>page_size 每页数目</li>
<li>page_query_param 前端发送的页数关键字名，默认为”page”</li>
<li>page_size_query_param 前端发送的每页数目关键字名，默认为None</li>
<li>max_page_size 前端最多能设置的每页数量</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework.pagination import PageNumberPagination</span><br><span class="line"></span><br><span class="line">class StandardPageNumberPagination(PageNumberPagination):</span><br><span class="line">    page_size_query_param = &#x27;page_size&#x27;</span><br><span class="line">    max_page_size = 10</span><br><span class="line"></span><br><span class="line">class BookListView(ListAPIView):</span><br><span class="line">    queryset = BookInfo.objects.all().order_by(&#x27;id&#x27;)</span><br><span class="line">    serializer_class = BookInfoSerializer</span><br><span class="line">    pagination_class = StandardPageNumberPagination</span><br><span class="line"></span><br><span class="line"># 127.0.0.1/books/?page=1&amp;page_size=2</span><br></pre></td></tr></table></figure>

<p>2）<strong>LimitOffsetPagination</strong></p>
<p>前端访问网址形式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET http://api.example.org/books/?limit=100&amp;offset=400</span><br></pre></td></tr></table></figure>

<p>可以在子类中定义的属性：</p>
<ul>
<li>default_limit 默认限制，默认值与 <code>PAGE_SIZE</code>设置一直</li>
<li>limit_query_param limit参数名，默认’limit’</li>
<li>offset_query_param offset参数名，默认’offset’</li>
<li>max_limit 最大limit限制，默认None</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework.pagination import LimitOffsetPagination</span><br><span class="line"></span><br><span class="line">class BookListView(ListAPIView):</span><br><span class="line">    queryset = BookInfo.objects.all().order_by(&#x27;id&#x27;)</span><br><span class="line">    serializer_class = BookInfoSerializer</span><br><span class="line">    pagination_class = LimitOffsetPagination</span><br><span class="line"></span><br><span class="line"># 127.0.0.1:8000/books/?offset=3&amp;limit=2</span><br></pre></td></tr></table></figure>

<h3 id="2-5-异常处理Exceptions"><a href="#2-5-异常处理Exceptions" class="headerlink" title="2.5 异常处理Exceptions"></a>2.5 异常处理Exceptions</h3><p>REST framework 提供了异常处理，我们可以自定义异常处理函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework.views import exception_handler</span><br><span class="line"></span><br><span class="line">def custom_exception_handler(exc, context):</span><br><span class="line">    # 先调用REST framework默认的异常处理方法获得标准错误响应对象</span><br><span class="line">    response = exception_handler(exc, context)</span><br><span class="line"></span><br><span class="line">    # 在此处补充自定义的异常处理</span><br><span class="line">    if response is not None:</span><br><span class="line">        response.data[&#x27;status_code&#x27;] = response.status_code</span><br><span class="line"></span><br><span class="line">    return response</span><br></pre></td></tr></table></figure>

<p>在配置文件中声明自定义的异常处理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    &#x27;EXCEPTION_HANDLER&#x27;: &#x27;my_project.my_app.utils.custom_exception_handler&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果未声明，会采用默认的方式，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    &#x27;EXCEPTION_HANDLER&#x27;: &#x27;rest_framework.views.exception_handler&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<p>补充上处理关于数据库的异常</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework.views import exception_handler as drf_exception_handler</span><br><span class="line">from rest_framework import status</span><br><span class="line">from django.db import DatabaseError</span><br><span class="line"></span><br><span class="line">def exception_handler(exc, context):</span><br><span class="line">    response = drf_exception_handler(exc, context)</span><br><span class="line"></span><br><span class="line">    if response is None:</span><br><span class="line">        view = context[&#x27;view&#x27;]</span><br><span class="line">        if isinstance(exc, DatabaseError):</span><br><span class="line">            print(&#x27;[%s]: %s&#x27; % (view, exc))</span><br><span class="line">            response = Response(&#123;&#x27;detail&#x27;: &#x27;服务器内部错误&#x27;&#125;, status=status.HTTP_507_INSUFFICIENT_STORAGE)</span><br><span class="line"></span><br><span class="line">    return response</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>REST framework定义的异常</p>
<ul>
<li>APIException 所有异常的父类</li>
<li>ParseError 解析错误</li>
<li>AuthenticationFailed 认证失败</li>
<li>NotAuthenticated 尚未认证</li>
<li>PermissionDenied 权限决绝</li>
<li>NotFound 未找到</li>
<li>MethodNotAllowed 请求方式不支持</li>
<li>NotAcceptable 要获取的数据格式不支持</li>
<li>Throttled 超过限流次数</li>
<li>ValidationError 校验失败</li>
</ul>
<h3 id="2-6-自动生成接口文档"><a href="#2-6-自动生成接口文档" class="headerlink" title="2.6 自动生成接口文档"></a>2.6 自动生成接口文档</h3><p>REST framework可以自动帮助我们生成接口文档。</p>
<p>接口文档以网页的方式呈现。</p>
<p>自动接口文档能生成的是继承自 <code>APIView</code>及其子类的视图。</p>
<h4 id="2-6-1-安装依赖"><a href="#2-6-1-安装依赖" class="headerlink" title="2.6.1 安装依赖"></a>2.6.1 安装依赖</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install coreapi</span><br></pre></td></tr></table></figure>

<h4 id="2-6-2-设置接口文档访问路径"><a href="#2-6-2-设置接口文档访问路径" class="headerlink" title="2.6.2 设置接口文档访问路径"></a>2.6.2 设置接口文档访问路径</h4><p>在总路由中添加接口文档路径。</p>
<p>文档路由对应的视图配置为 <code>rest_framework.documentation.include_docs_urls</code>，</p>
<p>参数 <code>title</code>为接口文档网站的标题。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework.documentation import include_docs_urls</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    ...</span><br><span class="line">    path(&#x27;docs/&#x27;, include_docs_urls(title=&#x27;站点页面标题&#x27;))</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>需要在配置文件settings.py中指定schema_class的配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    &#x27;DEFAULT_SCHEMA_CLASS&#x27;: &#x27;rest_framework.schemas.coreapi.AutoSchema&#x27;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-6-3-文档描述说明的定义位置"><a href="#2-6-3-文档描述说明的定义位置" class="headerlink" title="2.6.3 文档描述说明的定义位置"></a>2.6.3 文档描述说明的定义位置</h4><p>(1)单一方法的视图，可直接使用类视图的文档字符串，如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class BookListView(generics.ListAPIView):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    返回所有图书信息.</span><br><span class="line">    &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<p>(2) 包含多个方法的视图，在类视图的文档字符串中，分开方法定义，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class BookListCreateView(generics.ListCreateAPIView):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    get:</span><br><span class="line">    返回所有图书信息.</span><br><span class="line"></span><br><span class="line">    post:</span><br><span class="line">    新建图书.</span><br><span class="line">    &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<p>(3) 对于视图集ViewSet，仍在类视图的文档字符串中封开定义，但是应使用action名称区分，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">class BookInfoViewSet(mixins.ListModelMixin, mixins.RetrieveModelMixin, GenericViewSet):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    list:</span><br><span class="line">    返回图书列表数据</span><br><span class="line"></span><br><span class="line">    retrieve:</span><br><span class="line">    返回图书详情数据</span><br><span class="line"></span><br><span class="line">    latest:</span><br><span class="line">    返回最新的图书数据</span><br><span class="line"></span><br><span class="line">    read:</span><br><span class="line">    修改图书的阅读量</span><br><span class="line">    &quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h4 id="2-6-4-访问接口文档网页"><a href="#2-6-4-访问接口文档网页" class="headerlink" title="2.6.4 访问接口文档网页"></a>2.6.4 访问接口文档网页</h4><p>1） 视图集ViewSet中的retrieve名称，在接口文档网站中叫做read</p>
<p>2）参数的Description需要在模型类或序列化器类的字段中以help_text选项定义，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class BookInfo(models.Model):</span><br><span class="line">    ...</span><br><span class="line">    bread = models.IntegerField(default=0, verbose_name=&#x27;阅读量&#x27;, help_text=&#x27;阅读量&#x27;)</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class BookReadSerializer(serializers.ModelSerializer):</span><br><span class="line">    class Meta:</span><br><span class="line">        model = BookInfo</span><br><span class="line">        fields = (&#x27;bread&#x27;, )</span><br><span class="line">        extra_kwargs = &#123;</span><br><span class="line">            &#x27;bread&#x27;: &#123;</span><br><span class="line">                &#x27;required&#x27;: True,</span><br><span class="line">                &#x27;help_text&#x27;: &#x27;阅读量&#x27;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-DRF视图家族"><a href="#3-DRF视图家族" class="headerlink" title="3 DRF视图家族"></a>3 DRF视图家族</h2><p>Django REST framwork 提供的视图的主要作用：</p>
<ul>
<li>控制序列化器的执行（检验、保存、转换数据）</li>
<li>控制数据库查询的执行</li>
</ul>
<h3 id="3-1-两个视图基类"><a href="#3-1-两个视图基类" class="headerlink" title="3.1 两个视图基类"></a>3.1 两个视图基类</h3><p>APIView和GenericAPIView</p>
<h4 id="3-1-1-APIView"><a href="#3-1-1-APIView" class="headerlink" title="3.1.1 APIView"></a>3.1.1 APIView</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rest_framework.views.APIView</span><br></pre></td></tr></table></figure>

<p>APIView是REST framework提供的所有视图的基类，继承自Django的View父类</p>
<p>APIView 与 View 的不同之处在于：</p>
<ul>
<li>传入到视图方法中的是REST framework的 <code>Request</code>对象，而不是Django的 <code>HttpRequeset</code>对象；</li>
<li>视图方法可以返回REST framework的 <code>Response</code>对象，视图会为响应数据设置（render）符合前端要求的格式；</li>
<li>任何 <code>APIException</code>异常都会被捕获到，并且处理成合适的响应信息；</li>
<li>在进行dispatch()分发前，会对请求进行身份认证、权限检查、流量控制。</li>
</ul>
<p>支持定义的属性</p>
<ul>
<li><strong>authentication_classes</strong> 列表或元祖，身份认证类</li>
<li><strong>permissoin_classes</strong> 列表或元祖，权限检查类</li>
<li><strong>throttle_classes</strong> 列表或元祖，流量控制类</li>
</ul>
<p>在 <code>APIView</code>中仍以常规的类视图定义方法来实现get() 、post() 或者其他请求方式的方法。</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework.views import APIView</span><br><span class="line">from rest_framework.response import Response</span><br><span class="line"></span><br><span class="line"># url(r&#x27;^books/$&#x27;, views.BookListView.as_view()),</span><br><span class="line">class BookListView(APIView):</span><br><span class="line">    def get(self, request):</span><br><span class="line">        books = BookInfo.objects.all()</span><br><span class="line">        serializer = BookInfoSerializer(books, many=True)</span><br><span class="line">        return Response(serializer.data)</span><br></pre></td></tr></table></figure>

<h4 id="3-1-2-GenericAPIView"><a href="#3-1-2-GenericAPIView" class="headerlink" title="3.1.2 GenericAPIView"></a>3.1.2 GenericAPIView</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rest_framework.generics.GenericAPIView</span><br></pre></td></tr></table></figure>

<p>继承自 <code>APIVIew</code>，主要增加了操作序列化器和数据库查询的方法，作用是为下面Mixin扩展类的执行提供方法支持。通常在使用时，可搭配一个或多个Mixin扩展类。</p>
<p><strong>提供的关于序列化器使用的属性与方法</strong></p>
<ul>
<li><p>属性：</p>
<ul>
<li>serializer_class 指明视图使用的序列化器</li>
</ul>
</li>
<li><p>方法：</p>
<ul>
<li>get_serializer_class(self)<br>当出现一个视图类中调用多个序列化器时，那么可以通过条件来判断在get_serializer_class方法中通过返回不同的序列化器类名就可以让视图方法执行不同的序列化器对象了。<br>返回序列化器类，默认返回serializer_class，可以重写，例如：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def get_serializer_class(self):</span><br><span class="line">    if self.request.user.is_staff:</span><br><span class="line">        return FullAccountSerializer</span><br><span class="line">    return BasicAccountSerializer</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>get_serializer(self, args, *kwargs)</p>
<p>返回序列化器对象，主要用来提供给Mixin扩展类使用，如果我们在视图中想要获取序列化器对象，也可以直接调用此方法。</p>
<p>注意，该方法在提供序列化器对象的时候，会向序列化器对象的context属性补充三个数据：request、format、view，这三个数据对象可以在定义序列化器时使用。</p>
<ul>
<li>request 当前视图的请求对象</li>
<li>view 当前请求的类视图对象</li>
<li>format 当前请求期望返回的数据格式</li>
</ul>
</li>
</ul>
<p><strong>提供的关于数据库查询的属性与方法</strong></p>
<p>属性：</p>
<ul>
<li>queryset 指明使用的数据查询集</li>
</ul>
<p>方法：</p>
<ul>
<li><p>get_queryset(self)<br>返回视图使用的查询集，主要用来提供给Mixin扩展类使用，是列表视图与详情视图获取数据的基础，默认返回queryset属性，可以重写，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">def get_queryset(self):</span><br><span class="line">    user = self.request.user</span><br><span class="line">    return user.accounts.all()</span><br></pre></td></tr></table></figure></li>
<li><p>get_boject(self)</p>
<p>返回详情视图所需的模型类数据对象，主要用来提供给Mixin扩展类使用。<br>在视图中可以调用该方法获取详情信息的模型类对象。<br>若详情访问的模型类对象不存在，会返回404。<br>该方法会默认使用APIView提供的check_object_permissions方法检查当前对象是否有权限被访问。</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># url(r&#x27;^books/(?P&lt;pk&gt;\d+)/$&#x27;, views.BookDetailView.as_view()),</span><br><span class="line">class BookDetailView(GenericAPIView):</span><br><span class="line">    queryset = BookInfo.objects.all()</span><br><span class="line">    serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">    def get(self, request, pk):</span><br><span class="line">        book = self.get_object() # get_object()方法根据pk参数查找queryset中的数据对象</span><br><span class="line">        serializer = self.get_serializer(book)</span><br><span class="line">        return Response(serializer.data)</span><br></pre></td></tr></table></figure></li>
</ul>
<p>其他可以设置的属性</p>
<ul>
<li><strong>pagination_class</strong> 指明分页控制类</li>
<li><strong>filter_backends</strong> 指明过滤控制后端</li>
</ul>
<h4 id="3-1-3-DRF的请求对象"><a href="#3-1-3-DRF的请求对象" class="headerlink" title="3.1.3 DRF的请求对象"></a>3.1.3 DRF的请求对象</h4><p>REST framework 传入视图的request对象不再是Django默认的HttpRequest对象，而是REST framework提供的扩展了HttpRequest类的<strong>Request</strong>类的对象。</p>
<p>REST framework 提供了<strong>Parser</strong>解析器，在接收到请求后会自动根据Content-Type指明的请求数据类型（如JSON、表单等）将请求数据进行parse解析，解析为类字典[QueryDict]对象保存到<strong>Request</strong>对象中。</p>
<h5 id="1）-data"><a href="#1）-data" class="headerlink" title="1）.data"></a>1）.data</h5><p><code>request.data</code> 返回解析之后的请求体数据。类似于Django中标准的 <code>request.POST</code>和 <code>request.FILES</code>属性，但提供如下特性：</p>
<ul>
<li>包含了解析之后的文件和非文件数据</li>
<li>包含了对POST、PUT、PATCH请求方式解析后的数据</li>
<li>利用了REST framework的parsers解析器，不仅支持表单类型数据，也支持JSON数据</li>
</ul>
<h5 id="2）-query-params"><a href="#2）-query-params" class="headerlink" title="2）.query_params"></a>2）.query_params</h5><p><code>request.query_params</code>与Django标准的 <code>request.GET</code>相同，只是更换了更正确的名称而已。</p>
<h5 id="3）request-request"><a href="#3）request-request" class="headerlink" title="3）request._request"></a>3）request._request</h5><p>获取django封装的Request对象</p>
<p><strong>注意：要使用drf提供的Request请求处理对象，必须在编写视图类时继承drf提供的视图基类<br>from rest_framework.views import APIView</strong></p>
<h4 id="3-1-4-DRF的响应对象"><a href="#3-1-4-DRF的响应对象" class="headerlink" title="3.1.4 DRF的响应对象"></a>3.1.4 DRF的响应对象</h4><p>REST framework提供了一个响应类 <code>Response</code>，使用该类构造响应对象时，响应的具体数据内容会被转换（render渲染器）成符合前端需求的类型。</p>
<p>REST framework提供了 <code>Renderer</code> 渲染器，用来根据请求头中的 <code>Accept</code>（接收数据类型声明）来自动转换响应数据到对应格式。如果前端请求中未进行Accept声明，则会采用Content-Type方式处理响应数据，我们可以通过配置来修改默认响应格式。</p>
<p>可以在<strong>rest_framework.settings</strong>查找所有的drf默认配置项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    &#x27;DEFAULT_RENDERER_CLASSES&#x27;: (  # 默认响应渲染类</span><br><span class="line">        &#x27;rest_framework.renderers.JSONRenderer&#x27;,  # json渲染器，返回json数据</span><br><span class="line">        &#x27;rest_framework.renderers.BrowsableAPIRenderer&#x27;,  # 浏览器API渲染器，返回调试界面</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1）response的构造方式"><a href="#1）response的构造方式" class="headerlink" title="1）response的构造方式"></a>1）response的构造方式</h5><p>Response(data, status&#x3D;None, template_name&#x3D;None, headers&#x3D;None, content_type&#x3D;None)</p>
<p><code>data</code>数据不要是render处理之后的数据，只需传递python的内建类型数据即可，REST framework会使用 <code>renderer</code>渲染器处理 <code>data</code>。</p>
<p><code>data</code>不能是复杂结构的数据，如Django的模型类对象，对于这样的数据我们可以使用 <code>Serializer</code>序列化器序列化处理后（转为了Python字典类型）再传递给 <code>data</code>参数。</p>
<p>参数说明：</p>
<blockquote>
<ul>
<li><code>data</code>: 为响应准备的序列化处理后的数据；</li>
<li><code>status</code>: 状态码，默认200；</li>
<li><code>template_name</code>: 模板名称，如果使用 <code>HTMLRenderer</code> 时需指明；</li>
<li><code>headers</code>: 用于存放响应头信息的字典；</li>
<li><code>content_type</code>: 响应数据的Content-Type，通常此参数无需传递，REST framework会根据前端所需类型数据来设置该参数</li>
</ul>
</blockquote>
<h5 id="2）response对象的状态码"><a href="#2）response对象的状态码" class="headerlink" title="2）response对象的状态码"></a>2）response对象的状态码</h5><p>为了方便设置状态码，REST framewrok在 <code>rest_framework.status</code>模块中提供了常用http状态码的常量。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"># 1）信息告知 - 1xx</span><br><span class="line">HTTP_100_CONTINUE</span><br><span class="line">HTTP_101_SWITCHING_PROTOCOLS</span><br><span class="line"></span><br><span class="line"># 2）成功 - 2xx</span><br><span class="line">HTTP_200_OK</span><br><span class="line">HTTP_201_CREATED</span><br><span class="line">HTTP_202_ACCEPTED</span><br><span class="line">HTTP_203_NON_AUTHORITATIVE_INFORMATION</span><br><span class="line">HTTP_204_NO_CONTENT</span><br><span class="line">HTTP_205_RESET_CONTENT</span><br><span class="line">HTTP_206_PARTIAL_CONTENT</span><br><span class="line">HTTP_207_MULTI_STATUS</span><br><span class="line"></span><br><span class="line"># 3）重定向 - 3xx</span><br><span class="line">HTTP_300_MULTIPLE_CHOICES</span><br><span class="line">HTTP_301_MOVED_PERMANENTLY</span><br><span class="line">HTTP_302_FOUND</span><br><span class="line">HTTP_303_SEE_OTHER</span><br><span class="line">HTTP_304_NOT_MODIFIED</span><br><span class="line">HTTP_305_USE_PROXY</span><br><span class="line">HTTP_306_RESERVED</span><br><span class="line">HTTP_307_TEMPORARY_REDIRECT</span><br><span class="line"></span><br><span class="line"># 4）客户端错误 - 4xx</span><br><span class="line">HTTP_400_BAD_REQUEST</span><br><span class="line">HTTP_401_UNAUTHORIZED</span><br><span class="line">HTTP_402_PAYMENT_REQUIRED</span><br><span class="line">HTTP_403_FORBIDDEN</span><br><span class="line">HTTP_404_NOT_FOUND</span><br><span class="line">HTTP_405_METHOD_NOT_ALLOWED</span><br><span class="line">HTTP_406_NOT_ACCEPTABLE</span><br><span class="line">HTTP_407_PROXY_AUTHENTICATION_REQUIRED</span><br><span class="line">HTTP_408_REQUEST_TIMEOUT</span><br><span class="line">HTTP_409_CONFLICT</span><br><span class="line">HTTP_410_GONE</span><br><span class="line">HTTP_411_LENGTH_REQUIRED</span><br><span class="line">HTTP_412_PRECONDITION_FAILED</span><br><span class="line">HTTP_413_REQUEST_ENTITY_TOO_LARGE</span><br><span class="line">HTTP_414_REQUEST_URI_TOO_LONG</span><br><span class="line">HTTP_415_UNSUPPORTED_MEDIA_TYPE</span><br><span class="line">HTTP_416_REQUESTED_RANGE_NOT_SATISFIABLE</span><br><span class="line">HTTP_417_EXPECTATION_FAILED</span><br><span class="line">HTTP_422_UNPROCESSABLE_ENTITY</span><br><span class="line">HTTP_423_LOCKED</span><br><span class="line">HTTP_424_FAILED_DEPENDENCY</span><br><span class="line">HTTP_428_PRECONDITION_REQUIRED</span><br><span class="line">HTTP_429_TOO_MANY_REQUESTS</span><br><span class="line">HTTP_431_REQUEST_HEADER_FIELDS_TOO_LARGE</span><br><span class="line">HTTP_451_UNAVAILABLE_FOR_LEGAL_REASONS</span><br><span class="line"></span><br><span class="line"># 5）服务器错误 - 5xx</span><br><span class="line">HTTP_500_INTERNAL_SERVER_ERROR</span><br><span class="line">HTTP_501_NOT_IMPLEMENTED</span><br><span class="line">HTTP_502_BAD_GATEWAY</span><br><span class="line">HTTP_503_SERVICE_UNAVAILABLE</span><br><span class="line">HTTP_504_GATEWAY_TIMEOUT</span><br><span class="line">HTTP_505_HTTP_VERSION_NOT_SUPPORTED</span><br><span class="line">HTTP_507_INSUFFICIENT_STORAGE</span><br><span class="line">HTTP_511_NETWORK_AUTHENTICATION_REQUIRED</span><br></pre></td></tr></table></figure>

<h4 id="3-1-5-视图类源码解析"><a href="#3-1-5-视图类源码解析" class="headerlink" title="3.1.5 视图类源码解析"></a>3.1.5 视图类源码解析</h4><h5 id="1、View类的源码解析"><a href="#1、View类的源码解析" class="headerlink" title="1、View类的源码解析"></a>1、View类的源码解析</h5><p>View类核心代码在as_view和dispatch方法中，其中as_view是类方法（@classonlymethod），只能通过类调用，不能通过对象调用，它是类视图的入口点。注意这里调用的时候是通过类名.as_view()调用的。</p>
<p>其中，as_view方法主要执行逻辑：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># path(&#x27;books/&#x27;, views.BookViwe.as_view())</span><br><span class="line"># views.BookViwe.as_view()的执行结果，是函数内存地址----》view这个函数的内存地址</span><br><span class="line"># 请求来了---》路由匹配成功----》会执行 这个函数---》view(request)</span><br><span class="line"># view----》self.dispatch(request)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@classonlymethod</span></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">as_view</span>(<span class="params">cls, **initkwargs</span>):</span><br><span class="line">     <span class="string">&quot;&quot;&quot;Main entry point for a request-response process.&quot;&quot;&quot;</span></span><br><span class="line">     <span class="comment"># 参数检查</span></span><br><span class="line">     <span class="keyword">for</span> key <span class="keyword">in</span> initkwargs:</span><br><span class="line">     	<span class="keyword">if</span> key <span class="keyword">in</span> cls.http_method_names: <span class="comment"># 参数名不能是指定http的方法名</span></span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">&quot;You tried to pass in the %s method name as a &quot;</span></span><br><span class="line">             <span class="string">&quot;keyword argument to %s(). Don&#x27;t do that.&quot;</span></span><br><span class="line">             % (key, cls.__name__))</span><br><span class="line">  </span><br><span class="line">      	<span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(cls, key): <span class="comment"># 参数名必须是类已有属性</span></span><br><span class="line"> 			<span class="keyword">raise</span> TypeError(<span class="string">&quot;%s() received an invalid keyword %r. as_view &quot;</span></span><br><span class="line"> 				<span class="string">&quot;only accepts arguments that are already &quot;</span></span><br><span class="line"> 				<span class="string">&quot;attributes of the class.&quot;</span> % (cls.__name__, key))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 视图处理函数</span></span><br><span class="line">     <span class="keyword">def</span> <span class="title function_">view</span>(<span class="params">request, *args, **kwargs</span>):</span><br><span class="line">        <span class="variable language_">self</span> = cls(**initkwargs) <span class="comment"># 实例化当前类的对象</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(<span class="variable language_">self</span>, <span class="string">&#x27;get&#x27;</span>) <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(<span class="variable language_">self</span>, <span class="string">&#x27;head&#x27;</span>):</span><br><span class="line">            <span class="variable language_">self</span>.head = <span class="variable language_">self</span>.get</span><br><span class="line">        <span class="variable language_">self</span>.setup(request, *args, **kwargs)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(<span class="variable language_">self</span>, <span class="string">&#x27;request&#x27;</span>):</span><br><span class="line">             <span class="keyword">raise</span> AttributeError(</span><br><span class="line">             <span class="string">&quot;%s instance has no &#x27;request&#x27; attribute. Did you override &quot;</span></span><br><span class="line">             <span class="string">&quot;setup() and forget to call super()?&quot;</span> % cls.__name__</span><br><span class="line">             )</span><br><span class="line">        <span class="comment"># 方法派发</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.dispatch(request, *args, **kwargs)</span><br><span class="line">     view.view_class = cls</span><br><span class="line">     view.view_initkwargs = initkwargs</span><br><span class="line">  </span><br><span class="line">     <span class="comment"># take name and docstring from class</span></span><br><span class="line">     update_wrapper(view, cls, updated=())</span><br><span class="line">     <span class="comment"># and possible attributes set by decorators</span></span><br><span class="line">     <span class="comment"># like csrf_exempt from dispatch</span></span><br><span class="line">     update_wrapper(view, cls.dispatch, assigned=())</span><br><span class="line">     <span class="keyword">return</span> view <span class="comment"># 返回视图函数</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>整个as_view方法是一个装饰器函数，它返回内部函数view，所以as_view()执行其实就是内部函数view执行。内部函数view主要逻辑就是：as_view()&#x3D;&gt;view()&#x3D;&gt;dispatch()&#x3D;&gt;相应的http方法</p>
<p>dispatch方法是实例函数，它的主要代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dispatch---》你是什么请求，就会执行视图类中请求名字的方法</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">     <span class="comment">#检查请求方法是不是在http_method_names中包含</span></span><br><span class="line">     <span class="comment">#http_method_names包括八种方法：[&#x27;get&#x27;, &#x27;post&#x27;, &#x27;put&#x27;, &#x27;patch&#x27;, &#x27;delete&#x27;, &#x27;head&#x27;, </span></span><br><span class="line">     <span class="comment">#&#x27;options&#x27;, &#x27;trace&#x27;]</span></span><br><span class="line">     <span class="keyword">if</span> request.method.lower() <span class="keyword">in</span> <span class="variable language_">self</span>.http_method_names:</span><br><span class="line">    	 handler = <span class="built_in">getattr</span>(<span class="variable language_">self</span>, request.method.lower(), <span class="variable language_">self</span>.http_method_not_allowed)</span><br><span class="line">     <span class="keyword">else</span>: <span class="comment">#不在调用http_method_not_allowed报错</span></span><br><span class="line">     	handler = <span class="variable language_">self</span>.http_method_not_allowed</span><br><span class="line">     <span class="comment">#调用和请求方法同名的实例方法处理用户请求，实例方法需要用户自己定义</span></span><br><span class="line">     <span class="keyword">return</span> handler(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>总结</strong>：</p>
<p>dispatch主要完成http请求方法的派发，调用视图类对应实例方法处理用户请求，所有用户需要定义和http请求方法同名的实例方法完成功能，所以一般CBV的模块写法是：</p>
<p>所以：django的CBV本质上来说就是FBV</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views <span class="keyword">import</span> View</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IndexView</span>(<span class="title class_ inherited__">View</span>):</span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">self,request</span>):</span><br><span class="line"> 	<span class="keyword">return</span> HttpResponse(<span class="string">&quot;get&quot;</span>)</span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">post</span>(<span class="params">self,request</span>):</span><br><span class="line"> 	<span class="keyword">return</span> HttpResponse(<span class="string">&quot;post&quot;</span>)</span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">put</span>(<span class="params">self,request</span>):</span><br><span class="line"> 	<span class="keyword">return</span> HttpResponse(<span class="string">&quot;put&quot;</span>)</span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">self,request</span>):</span><br><span class="line"> 	<span class="keyword">return</span> HttpResponse(<span class="string">&quot;delete&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="2、APIView源码解析"><a href="#2、APIView源码解析" class="headerlink" title="2、APIView源码解析"></a>2、APIView源码解析</h5><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/482/1659679413054/b24df2eff5c841d0bec870cfdde2f951.png" alt="image.png"></p>
<p><strong>as_view()源码：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">as_view</span>(<span class="params">cls, **initkwargs</span>):</span><br><span class="line">        <span class="comment"># 如果他是QuerySet的一个实例</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(<span class="built_in">getattr</span>(cls, <span class="string">&#x27;queryset&#x27;</span>, <span class="literal">None</span>), models.query.QuerySet):</span><br><span class="line">            <span class="keyword">def</span> <span class="title function_">force_evaluation</span>():</span><br><span class="line">                <span class="comment"># 翻译：不要直接计算“.queryset”属性，因为结果将被缓存并在请求之间重用请改用“.all（）”或调用“.get_queryset（）”</span></span><br><span class="line">                <span class="keyword">raise</span> RuntimeError(</span><br><span class="line">                    <span class="string">&#x27;Do not evaluate the `.queryset` attribute directly, &#x27;</span></span><br><span class="line">                    <span class="string">&#x27;as the result will be cached and reused between requests. &#x27;</span></span><br><span class="line">                    <span class="string">&#x27;Use `.all()` or call `.get_queryset()` instead.&#x27;</span></span><br><span class="line">                )</span><br><span class="line">            <span class="comment"># 强制性把属性拿过来</span></span><br><span class="line">            cls.queryset._fetch_all = force_evaluation</span><br><span class="line">  </span><br><span class="line">	<span class="comment"># 该走这里了，调用父类的as_view() --- 父类的as_view()核心是dispatch()  &gt;&gt; 跳转到dispatch()</span></span><br><span class="line">        view = <span class="built_in">super</span>().as_view(**initkwargs)</span><br><span class="line">        view.cls = cls</span><br><span class="line">        view.initkwargs = initkwargs</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Note: session based authentication is explicitly CSRF validated,</span></span><br><span class="line">        <span class="comment"># all other authentication is CSRF exempt.</span></span><br><span class="line">  </span><br><span class="line">        <span class="comment"># 豁免csrf检测, 返回view</span></span><br><span class="line">        <span class="keyword">return</span> csrf_exempt(view)	 <span class="comment"># 函数里面套函数，这个一个装饰器！！！</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>dispatch()源码</strong></p>
<p>源代码代码步骤</p>
<ol>
<li>记录各个参数</li>
<li>initializer_request()</li>
<li>initial  加载各种中间件</li>
<li>根据得到的请求方法去处理，或处理异常</li>
<li>最后统一处理response</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dispatch</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        `.dispatch()` is pretty much the same as Django&#x27;s regular dispatch,</span></span><br><span class="line"><span class="string">        but with extra hooks for startup, finalize, and exception handling.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.args = args</span><br><span class="line">        <span class="variable language_">self</span>.kwargs = kwargs</span><br><span class="line">        <span class="comment"># 跳转看一看 &gt;&gt; initializer_request()</span></span><br><span class="line">        request = <span class="variable language_">self</span>.initialize_request(request, *args, **kwargs)</span><br><span class="line">  </span><br><span class="line">        <span class="variable language_">self</span>.request = request</span><br><span class="line">        <span class="variable language_">self</span>.headers = <span class="variable language_">self</span>.default_response_headers  <span class="comment"># deprecate?</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># 再跳一跳 &gt;&gt; initial()</span></span><br><span class="line">            <span class="variable language_">self</span>.initial(request, *args, **kwargs)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Get the appropriate handler method</span></span><br><span class="line">            <span class="comment"># 根据请求方法名字去处理</span></span><br><span class="line">            <span class="keyword">if</span> request.method.lower() <span class="keyword">in</span> <span class="variable language_">self</span>.http_method_names:</span><br><span class="line">                handler = <span class="built_in">getattr</span>(<span class="variable language_">self</span>, request.method.lower(),</span><br><span class="line">                                  <span class="variable language_">self</span>.http_method_not_allowed)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                handler = <span class="variable language_">self</span>.http_method_not_allowed</span><br><span class="line"></span><br><span class="line">            response = handler(request, *args, **kwargs)</span><br><span class="line">	<span class="comment"># 异常处理机制</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> exc:</span><br><span class="line">            response = <span class="variable language_">self</span>.handle_exception(exc)</span><br><span class="line">	<span class="comment"># 统一处理</span></span><br><span class="line">        <span class="variable language_">self</span>.response = <span class="variable language_">self</span>.finalize_response(request, response, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.response</span><br></pre></td></tr></table></figure>

<p><strong>initialize_request() 源码</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">initialize_request</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Returns the initial request object.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 解析上下文</span></span><br><span class="line">        parser_context = <span class="variable language_">self</span>.get_parser_context(request)</span><br><span class="line">  </span><br><span class="line">	<span class="comment"># 构建了一个新的request</span></span><br><span class="line">        <span class="keyword">return</span> Request(</span><br><span class="line">            request,</span><br><span class="line">            parsers=<span class="variable language_">self</span>.get_parsers(),</span><br><span class="line">            authenticators=<span class="variable language_">self</span>.get_authenticators(),</span><br><span class="line">            negotiator=<span class="variable language_">self</span>.get_content_negotiator(),</span><br><span class="line">            parser_context=parser_context</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>

<p><strong>initial(): 源码</strong></p>
<p>步骤：</p>
<ul>
<li>获取格式化后缀</li>
<li>设置并执行内容协商</li>
<li>设置并进行   决策版本，确定版本</li>
<li>执行认证（重点）</li>
<li>检查权限</li>
<li>检查限流</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">initial</span>(<span class="params">self, request, *args, **kwargs</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Runs anything that needs to occur prior to calling the method handler.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 获取格式化的后缀</span></span><br><span class="line">        <span class="variable language_">self</span>.format_kwarg = <span class="variable language_">self</span>.get_format_suffix(**kwargs)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Perform content negotiation and store the accepted info on the request</span></span><br><span class="line">        <span class="comment"># 设置内容协商并存储请求中已接受的信息</span></span><br><span class="line">        neg = <span class="variable language_">self</span>.perform_content_negotiation(request)</span><br><span class="line">        <span class="comment"># 执行</span></span><br><span class="line">        request.accepted_renderer, request.accepted_media_type = neg</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Determine the API version, if versioning is in use.</span></span><br><span class="line">        <span class="comment"># 设置决策版本</span></span><br><span class="line">        version, scheme = <span class="variable language_">self</span>.determine_version(request, *args, **kwargs)</span><br><span class="line">        <span class="comment"># 执行确定版本</span></span><br><span class="line">        request.version, request.versioning_scheme = version, scheme</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Ensure that the incoming request is permitted</span></span><br><span class="line">        <span class="comment"># 执行认证，检查权限，检查限流</span></span><br><span class="line">        <span class="variable language_">self</span>.perform_authentication(request)</span><br><span class="line">        <span class="variable language_">self</span>.check_permissions(request)</span><br><span class="line">        <span class="variable language_">self</span>.check_throttles(request)</span><br></pre></td></tr></table></figure>

<h5 id="3、GenericAPIView源码解析"><a href="#3、GenericAPIView源码解析" class="headerlink" title="3、GenericAPIView源码解析"></a>3、GenericAPIView源码解析</h5><p><code>GenericAPIView</code>继承自 <code>APIView</code>，也就是在 <code>APIView</code>基础上再做了一层封装</p>
<p><strong>类属性</strong></p>
<ol>
<li>queryset &#x3D; None</li>
<li>serializer_class &#x3D; None</li>
<li>lookup_field &#x3D; ‘pk’</li>
<li>lookup_url_kwarg &#x3D; None</li>
<li>filter_backends &#x3D; api_settings.DEFAULT_FILTER_BACKENDS</li>
<li>pagination_class &#x3D; api_settings.DEFAULT_PAGINATION_CLASS</li>
</ol>
<p><strong>queryset</strong><br>  queryset是用来控制视图返回给前端的数据。如果没什么逻辑，可以直接写在视图的类属性中，如果逻辑比较复杂，也可以重写get_queryset方法用来返回一个queryset对象。如果重写了get_queryset，那么以后获取queryset的时候就需要通过调用get_queryset方法。因为queryset&#96; 这个属性只会调用一次，以后所有的请求都是使用他的缓存。</p>
<p><strong>serializer_class</strong><br>  serializer_class用来验证和序列化、反序列化数据的。也是可以通过直接设置这个属性，也可以通过重写get_serializer_class来实现。</p>
<p><strong>lookup_field</strong><br>在检索的时候，根据什么参数进行检索。默认是pk，也就是主键。</p>
<p><strong>lookup_url_kwarg</strong><br>在检索的url中的参数名称。默认没有设置，跟lookup_field保持一致。</p>
<p><strong>filter_backends</strong><br>用于过滤查询集的过滤器后端类的列表。默认值与DEFAULT_FILTER_BACKENDS 设置的值相同。</p>
<p><strong>pagination_class</strong><br>当分页列出结果时应使用的分页类。默认值与 DEFAULT_PAGINATION_CLASS 设置的值相同，即 ‘rest_framework.pagination.PageNumberPagination’。</p>
<p><strong>方法</strong></p>
<ol>
<li>get_queryset</li>
<li>get_object</li>
<li>get_serializer</li>
<li>get_serializer_class</li>
<li>get_serializer_context</li>
<li>filter_queryset</li>
</ol>
<p><strong>get_queryset</strong></p>
<p><code>get_queryset</code>默认是返回数据库全部数据，如果想返回其他数据，需要自定义</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_queryset</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="comment"># 断言queryset是否不为None</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="variable language_">self</span>.queryset <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>, (</span><br><span class="line">        <span class="string">&quot;&#x27;%s&#x27; should either include a `queryset` attribute, &quot;</span></span><br><span class="line">        <span class="string">&quot;or override the `get_queryset()` method.&quot;</span></span><br><span class="line">        % <span class="variable language_">self</span>.__class__.__name__</span><br><span class="line">    )</span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 定义queryset属性，获取父类的queryset，如果父类没有定义类属性`queryset`，那么默认值就是None，就会报上面断言的错误 </span></span><br><span class="line">    queryset = <span class="variable language_">self</span>.queryset</span><br><span class="line">    <span class="comment"># 如果queryset是QuerySet对象，那么返回全部内容</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(queryset, QuerySet):</span><br><span class="line">        queryset = queryset.<span class="built_in">all</span>()</span><br><span class="line">    <span class="comment"># 如果不是queryset，那么直接返回</span></span><br><span class="line">    <span class="keyword">return</span> queryset</span><br></pre></td></tr></table></figure>

<p><strong>get_object</strong></p>
<p>该方法是用于在数据检索(通过pk查找)的时候，返回一条数据的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_object</span>(<span class="params">self</span>):</span><br><span class="line">    queryset = <span class="variable language_">self</span>.filter_queryset(<span class="variable language_">self</span>.get_queryset())</span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 查找过滤的条件，默认是pk</span></span><br><span class="line">    lookup_url_kwarg = <span class="variable language_">self</span>.lookup_url_kwarg <span class="keyword">or</span> <span class="variable language_">self</span>.lookup_field</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">assert</span> lookup_url_kwarg <span class="keyword">in</span> <span class="variable language_">self</span>.kwargs, (</span><br><span class="line">        <span class="string">&#x27;Expected view %s to be called with a URL keyword argument &#x27;</span></span><br><span class="line">        <span class="string">&#x27;named &quot;%s&quot;. Fix your URL conf, or set the `.lookup_field` &#x27;</span></span><br><span class="line">        <span class="string">&#x27;attribute on the view correctly.&#x27;</span> %</span><br><span class="line">        (<span class="variable language_">self</span>.__class__.__name__, lookup_url_kwarg)</span><br><span class="line">    )</span><br><span class="line">  </span><br><span class="line">    filter_kwargs = &#123;<span class="variable language_">self</span>.lookup_field: <span class="variable language_">self</span>.kwargs[lookup_url_kwarg]&#125;</span><br><span class="line">    obj = get_object_or_404(queryset, **filter_kwargs)</span><br><span class="line">  </span><br><span class="line">    <span class="comment"># 可能会引发权限被拒绝</span></span><br><span class="line">    <span class="variable language_">self</span>.check_object_permissions(<span class="variable language_">self</span>.request, obj)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> obj</span><br></pre></td></tr></table></figure>

<p><strong>get_serializer</strong></p>
<p>返回应该用于验证和反序列化输入以及序列化输出的序列化器实例</p>
<p><strong>get_serializer_class</strong></p>
<p>返回用于序列化的类。默认使用 <code>self.serializer_class</code>。如果您需要根据传入请求提供不同的序列化，您可能需要重写它。</p>
<h3 id="3-2-5个视图扩展类"><a href="#3-2-5个视图扩展类" class="headerlink" title="3.2  5个视图扩展类"></a>3.2  5个视图扩展类</h3><p>作用：</p>
<p>提供了几种后端视图（对数据资源进行曾删改查）处理流程的实现，如果需要编写的视图属于这五种，则视图可以通过继承相应的扩展类来复用代码，减少自己编写的代码量。</p>
<p>这五个扩展类需要搭配GenericAPIView父类，因为五个扩展类的实现需要调用GenericAPIView提供的序列化器与数据库查询的方法。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/482/1620998133146189824/ff12dc5e8ed14ea99c68f01278ddbe69.png" alt="image.png"></p>
<h4 id="1-ListModeMixin"><a href="#1-ListModeMixin" class="headerlink" title="(1) ListModeMixin"></a>(1) ListModeMixin</h4><p>列表视图扩展类，提供 <code>list(request, *args, **kwargs)</code>方法快速实现列表视图，返回200状态码。</p>
<p>该Mixin的list方法会对数据进行过滤和分页。</p>
<p>源代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class ListModelMixin(object):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    List a queryset.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    def list(self, request, *args, **kwargs):</span><br><span class="line">        # 过滤</span><br><span class="line">        queryset = self.filter_queryset(self.get_queryset())</span><br><span class="line">        # 分页</span><br><span class="line">        page = self.paginate_queryset(queryset)</span><br><span class="line">        if page is not None:</span><br><span class="line">            serializer = self.get_serializer(page, many=True)</span><br><span class="line">            return self.get_paginated_response(serializer.data)</span><br><span class="line">        # 序列化</span><br><span class="line">        serializer = self.get_serializer(queryset, many=True)</span><br><span class="line">        return Response(serializer.data)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework.mixins import ListModelMixin</span><br><span class="line"></span><br><span class="line">class BookListView(ListModelMixin, GenericAPIView):</span><br><span class="line">    queryset = BookInfo.objects.all()</span><br><span class="line">    serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">    def get(self, request):</span><br><span class="line">        return self.list(request)</span><br></pre></td></tr></table></figure>

<h4 id="2-CreateModeMixin"><a href="#2-CreateModeMixin" class="headerlink" title="(2) CreateModeMixin"></a>(2) CreateModeMixin</h4><p>创建视图扩展类，提供 <code>create(request, *args, **kwargs)</code>方法快速实现创建资源的视图，成功返回201状态码。</p>
<p>如果序列化器对前端发送的数据验证失败，返回400错误。</p>
<p>源代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">class CreateModelMixin(object):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Create a model instance.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    def create(self, request, *args, **kwargs):</span><br><span class="line">        # 获取序列化器</span><br><span class="line">        serializer = self.get_serializer(data=request.data)</span><br><span class="line">        # 验证</span><br><span class="line">        serializer.is_valid(raise_exception=True)</span><br><span class="line">        # 保存</span><br><span class="line">        self.perform_create(serializer)</span><br><span class="line">        headers = self.get_success_headers(serializer.data)</span><br><span class="line">        return Response(serializer.data, status=status.HTTP_201_CREATED, headers=headers)</span><br><span class="line"></span><br><span class="line">    def perform_create(self, serializer):</span><br><span class="line">        serializer.save()</span><br><span class="line"></span><br><span class="line">    def get_success_headers(self, data):</span><br><span class="line">        try:</span><br><span class="line">            return &#123;&#x27;Location&#x27;: str(data[api_settings.URL_FIELD_NAME])&#125;</span><br><span class="line">        except (TypeError, KeyError):</span><br><span class="line">            return &#123;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-RetrieveModelMixin"><a href="#3-RetrieveModelMixin" class="headerlink" title="(3) RetrieveModelMixin"></a>(3) RetrieveModelMixin</h4><p>详情视图扩展类，提供 <code>retrieve(request, *args, **kwargs)</code>方法，可以快速实现返回一个存在的数据对象。</p>
<p>如果存在，返回200， 否则返回404。</p>
<p>源代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class RetrieveModelMixin(object):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Retrieve a model instance.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    def retrieve(self, request, *args, **kwargs):</span><br><span class="line">        # 获取对象，会检查对象的权限</span><br><span class="line">        instance = self.get_object()</span><br><span class="line">        # 序列化</span><br><span class="line">        serializer = self.get_serializer(instance)</span><br><span class="line">        return Response(serializer.data)</span><br></pre></td></tr></table></figure>

<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class BookDetailView(RetrieveModelMixin, GenericAPIView):</span><br><span class="line">    queryset = BookInfo.objects.all()</span><br><span class="line">    serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">    def get(self, request, pk):</span><br><span class="line">        return self.retrieve(request)</span><br></pre></td></tr></table></figure>

<h4 id="4-UpdateModelMixin"><a href="#4-UpdateModelMixin" class="headerlink" title="(4) UpdateModelMixin"></a>(4) UpdateModelMixin</h4><p>更新视图扩展类，提供 <code>update(request, *args, **kwargs)</code>方法，可以快速实现更新一个存在的数据对象。</p>
<p>同时也提供 <code>partial_update(request, *args, **kwargs)</code>方法，可以实现局部更新。</p>
<p>成功返回200，序列化器校验数据失败时，返回400错误。</p>
<p>源代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">class UpdateModelMixin(object):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Update a model instance.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    def update(self, request, *args, **kwargs):</span><br><span class="line">        partial = kwargs.pop(&#x27;partial&#x27;, False)</span><br><span class="line">        instance = self.get_object()</span><br><span class="line">        serializer = self.get_serializer(instance, data=request.data, partial=partial)</span><br><span class="line">        serializer.is_valid(raise_exception=True)</span><br><span class="line">        self.perform_update(serializer)</span><br><span class="line"></span><br><span class="line">        if getattr(instance, &#x27;_prefetched_objects_cache&#x27;, None):</span><br><span class="line">            # If &#x27;prefetch_related&#x27; has been applied to a queryset, we need to</span><br><span class="line">            # forcibly invalidate the prefetch cache on the instance.</span><br><span class="line">            instance._prefetched_objects_cache = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        return Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    def perform_update(self, serializer):</span><br><span class="line">        serializer.save()</span><br><span class="line"></span><br><span class="line">    def partial_update(self, request, *args, **kwargs):</span><br><span class="line">        kwargs[&#x27;partial&#x27;] = True</span><br><span class="line">        return self.update(request, *args, **kwargs)</span><br></pre></td></tr></table></figure>

<h4 id="5-DestroyModelMixin"><a href="#5-DestroyModelMixin" class="headerlink" title="(5) DestroyModelMixin"></a>(5) DestroyModelMixin</h4><p>删除视图扩展类，提供 <code>destroy(request, *args, **kwargs)</code>方法，可以快速实现删除一个存在的数据对象。</p>
<p>成功返回204，不存在返回404。</p>
<p>源代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class DestroyModelMixin(object):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    Destroy a model instance.</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    def destroy(self, request, *args, **kwargs):</span><br><span class="line">        instance = self.get_object()</span><br><span class="line">        self.perform_destroy(instance)</span><br><span class="line">        return Response(status=status.HTTP_204_NO_CONTENT)</span><br><span class="line"></span><br><span class="line">    def perform_destroy(self, instance):</span><br><span class="line">        instance.delete()</span><br></pre></td></tr></table></figure>

<h3 id="3-3-几个子类视图"><a href="#3-3-几个子类视图" class="headerlink" title="3.3 几个子类视图"></a>3.3 几个子类视图</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/482/1620998133146189824/41ee2cb258b6458c9982f10787f98c3b.png" alt="image.png"></p>
<h4 id="1）CreateAPIView"><a href="#1）CreateAPIView" class="headerlink" title="(1）CreateAPIView"></a>(1）CreateAPIView</h4><p>提供 post 方法</p>
<p>继承自： GenericAPIView、CreateModelMixin</p>
<h4 id="2）ListAPIView"><a href="#2）ListAPIView" class="headerlink" title="(2）ListAPIView"></a>(2）ListAPIView</h4><p>提供 get 方法</p>
<p>继承自：GenericAPIView、ListModelMixin</p>
<h4 id="3）RetrieveAPIView"><a href="#3）RetrieveAPIView" class="headerlink" title="(3）RetrieveAPIView"></a>(3）RetrieveAPIView</h4><p>提供 get 方法</p>
<p>继承自: GenericAPIView、RetrieveModelMixin</p>
<h4 id="4）DestoryAPIView"><a href="#4）DestoryAPIView" class="headerlink" title="(4）DestoryAPIView"></a>(4）DestoryAPIView</h4><p>提供 delete 方法</p>
<p>继承自：GenericAPIView、DestoryModelMixin</p>
<h4 id="5）UpdateAPIView"><a href="#5）UpdateAPIView" class="headerlink" title="(5）UpdateAPIView"></a>(5）UpdateAPIView</h4><p>提供 put 和 patch 方法</p>
<p>继承自：GenericAPIView、UpdateModelMixin</p>
<h4 id="6）RetrieveUpdateAPIView"><a href="#6）RetrieveUpdateAPIView" class="headerlink" title="6）RetrieveUpdateAPIView"></a>6）RetrieveUpdateAPIView</h4><p>提供 get、put、patch方法</p>
<p>继承自： GenericAPIView、RetrieveModelMixin、UpdateModelMixin</p>
<h4 id="7）RetrieveUpdateDestoryAPIView"><a href="#7）RetrieveUpdateDestoryAPIView" class="headerlink" title="7）RetrieveUpdateDestoryAPIView"></a>7）RetrieveUpdateDestoryAPIView</h4><p>提供 get、put、patch、delete方法</p>
<p>继承自：GenericAPIView、RetrieveModelMixin、UpdateModelMixin、DestoryModelMixin</p>
<h3 id="3-4-视图集ViewSet"><a href="#3-4-视图集ViewSet" class="headerlink" title="3.4 视图集ViewSet"></a>3.4 视图集ViewSet</h3><p>为了让视图代码变得更加简短,让操作同一个模型的视图方法写在一个视图类中, drf提供了视图集[viewsets]。</p>
<ul>
<li><strong>1.视图集允许开发者自定义类视图方法名</strong></li>
<li><strong>2.视图集允许一个类分配多个不同的路由</strong></li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/482/1620998133146189824/a8176780480a4aefbcb0873a7eebc9c9.png" alt="image.png"></p>
<h4 id="3-4-1-常用视图集父类"><a href="#3-4-1-常用视图集父类" class="headerlink" title="3.4.1 常用视图集父类"></a>3.4.1 常用视图集父类</h4><p>(1) ViewSet</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">继承自APIView与ViewSetMixin，作用也与APIView基本类似，提供了身份认证、权限校验、流量管理等。</span><br><span class="line"></span><br><span class="line">ViewSet主要通过继承ViewSetMixin来实现在调用as_view()时传入字典（如&#123;&#x27;get&#x27;:&#x27;list&#x27;&#125;）的映射处理工作。</span><br><span class="line"></span><br><span class="line">在ViewSet中，没有提供任何动作action方法，需要我们自己实现action方法。</span><br></pre></td></tr></table></figure>

<p>(2) GenericViewSet</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">使用ViewSet通常并不方便，因为list、retrieve、create、update、destory等方法都需要自己编写，而这些方法与前面讲过的Mixin扩展类提供的方法同名，所以我们可以通过继承Mixin扩展类来复用这些方法而无需自己编写。但是Mixin扩展类依赖与GenericAPIView，所以还需要继承GenericAPIView。</span><br><span class="line"></span><br><span class="line">GenericViewSet就帮助我们完成了这样的继承工作，继承自GenericAPIView与ViewSetMixin，在实现了调用as_view()时传入字典（如&#123;&#x27;get&#x27;:&#x27;list&#x27;&#125;）的映射处理工作的同时，还提供了GenericAPIView提供的基础方法，可以直接搭配Mixin扩展类使用。</span><br></pre></td></tr></table></figure>

<p>举例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework import mixins</span><br><span class="line">from rest_framework.viewsets import GenericViewSet</span><br><span class="line">from rest_framework.decorators import action</span><br><span class="line"></span><br><span class="line">class BookInfoViewSet(mixins.ListModelMixin, mixins.RetrieveModelMixin, GenericViewSet):</span><br><span class="line">    queryset = BookInfo.objects.all()</span><br><span class="line">    serializer_class = BookInfoSerializer</span><br></pre></td></tr></table></figure>

<p>url的定义</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    url(r&#x27;^books/$&#x27;, views.BookInfoViewSet.as_view(&#123;&#x27;get&#x27;: &#x27;list&#x27;&#125;)),</span><br><span class="line">    url(r&#x27;^books/(?P&lt;pk&gt;\d+)/$&#x27;, views.BookInfoViewSet.as_view(&#123;&#x27;get&#x27;: &#x27;retrieve&#x27;&#125;)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>(3) ModelViewSet</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">继承自GenericViewSet，同时包括了ListModelMixin、RetrieveModelMixin、CreateModelMixin、UpdateModelMixin、DestoryModelMixin。</span><br></pre></td></tr></table></figure>

<p>(4) ReadOnlyModelViewSet</p>
<p>继承自 <code>GenericViewSet</code>，同时包括了ListModelMixin、RetrieveModelMixin。</p>
<h4 id="3-4-2-视图集中定义附加action动作"><a href="#3-4-2-视图集中定义附加action动作" class="headerlink" title="3.4.2 视图集中定义附加action动作"></a>3.4.2 视图集中定义附加action动作</h4><p>在视图集中，除了上述默认的方法动作外，还可以添加自定义动作。</p>
<p>举例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework import mixins</span><br><span class="line">from rest_framework.viewsets import GenericViewSet</span><br><span class="line">from rest_framework.decorators import action</span><br><span class="line"></span><br><span class="line">class BookInfoViewSet(mixins.ListModelMixin, mixins.RetrieveModelMixin, GenericViewSet):</span><br><span class="line">    queryset = BookInfo.objects.all()</span><br><span class="line">    serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">    def latest(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        返回最新的图书信息</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        book = BookInfo.objects.latest(&#x27;id&#x27;)</span><br><span class="line">        serializer = self.get_serializer(book)</span><br><span class="line">        return Response(serializer.data)</span><br><span class="line"></span><br><span class="line">    def read(self, request, pk):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        修改图书的阅读量数据</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        book = self.get_object()</span><br><span class="line">        book.bread = request.data.get(&#x27;read&#x27;)</span><br><span class="line">        book.save()</span><br><span class="line">        serializer = self.get_serializer(book)</span><br><span class="line">        return Response(serializer.data)</span><br></pre></td></tr></table></figure>

<p>url的定义</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    url(r&#x27;^books/$&#x27;, views.BookInfoViewSet.as_view(&#123;&#x27;get&#x27;: &#x27;list&#x27;&#125;)),</span><br><span class="line">    url(r&#x27;^books/latest/$&#x27;, views.BookInfoViewSet.as_view(&#123;&#x27;get&#x27;: &#x27;latest&#x27;&#125;)),</span><br><span class="line">    url(r&#x27;^books/(?P&lt;pk&gt;\d+)/$&#x27;, views.BookInfoViewSet.as_view(&#123;&#x27;get&#x27;: &#x27;retrieve&#x27;&#125;)),</span><br><span class="line">    url(r&#x27;^books/(?P&lt;pk&gt;\d+)/read/$&#x27;, views.BookInfoViewSet.as_view(&#123;&#x27;put&#x27;: &#x27;read&#x27;&#125;)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="3-4-3-action属性"><a href="#3-4-3-action属性" class="headerlink" title="3.4.3 action属性"></a>3.4.3 action属性</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework.viewsets import ModelViewSet,ReadOnlyModelViewSet</span><br><span class="line">from booktest.models import BookInfo</span><br><span class="line">from .serializers import BookInfoModelSerializer</span><br><span class="line">from rest_framework.response import Response</span><br><span class="line">class BookInfoModelViewSet(ModelViewSet):</span><br><span class="line">    queryset = BookInfo.objects.all()</span><br><span class="line">    serializer_class = BookInfoModelSerializer</span><br><span class="line"></span><br><span class="line">    def get_top_5(self,request):</span><br><span class="line">        &quot;&quot;&quot;获取评论值最多的5条数据&quot;&quot;&quot;</span><br><span class="line">        # 操作数据库</span><br><span class="line">        print(self.action) # 获取本次请求的视图方法名</span><br></pre></td></tr></table></figure>

<p>通过路由访问到当前方法中，可以看到本次的action就是请求的方法名</p>
<h3 id="3-5-路由Routers"><a href="#3-5-路由Routers" class="headerlink" title="3.5 路由Routers"></a>3.5 路由Routers</h3><p>对于视图集ViewSet，我们除了可以自己手动指明请求方式与动作action之间的对应关系外，还可以使用Routers来帮助我们快速实现路由信息。</p>
<p>REST framework提供了两个router</p>
<ul>
<li><strong>SimpleRouter</strong></li>
<li><strong>DefaultRouter</strong></li>
</ul>
<h4 id="3-5-1-使用方法"><a href="#3-5-1-使用方法" class="headerlink" title="3.5.1 使用方法"></a>3.5.1 使用方法</h4><p>(1) 创建router对象，并注册视图集，例如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework import routers</span><br><span class="line"></span><br><span class="line">router = routers.SimpleRouter()</span><br><span class="line">router.register(r&#x27;books&#x27;, BookInfoViewSet, base_name=&#x27;book&#x27;)</span><br></pre></td></tr></table></figure>

<p>register(prefix, viewset, base_name)</p>
<ul>
<li>prefix 该视图集的路由前缀</li>
<li>viewset 视图集</li>
<li>base_name 路由名称的前缀</li>
</ul>
<p>如上述代码会形成的路由如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">^books/$    name: book-list</span><br><span class="line">^books/&#123;pk&#125;/$   name: book-detail</span><br></pre></td></tr></table></figure>

<p>(2) 添加路由数据</p>
<p>可以有两种方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    ...</span><br><span class="line">]</span><br><span class="line">urlpatterns += router.urls</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    ...</span><br><span class="line">    url(r&#x27;^&#x27;, include(router.urls))</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="3-5-2-视图集中附加action的声明"><a href="#3-5-2-视图集中附加action的声明" class="headerlink" title="3.5.2 视图集中附加action的声明"></a>3.5.2 视图集中附加action的声明</h4><p>在视图集中，如果想要让Router自动帮助我们为自定义的动作生成路由信息，需要使用 <code>rest_framework.decorators.action</code>装饰器。</p>
<p>以action装饰器装饰的方法名会作为action动作名，与list、retrieve等同。</p>
<p>action装饰器可以接收两个参数：</p>
<ul>
<li><p><strong>methods</strong> : 声明该action对应的请求方式，列表传递</p>
</li>
<li><p>detail声明该action的路径是否与单一资源对应，及是否是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xxx/&lt;pk&gt;/action方法名/</span><br></pre></td></tr></table></figure></li>
<li><p>True表示路径格式是：xxx&#x2F;<pk>&#x2F;action方法名&#x2F;</p>
</li>
<li><p>False表示路径格式是：xxx&#x2F;action方法名</p>
</li>
</ul>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework import mixins</span><br><span class="line">from rest_framework.viewsets import GenericViewSet</span><br><span class="line">from rest_framework.decorators import action</span><br><span class="line"></span><br><span class="line">class BookInfoViewSet(mixins.ListModelMixin, mixins.RetrieveModelMixin, GenericViewSet):</span><br><span class="line">    queryset = BookInfo.objects.all()</span><br><span class="line">    serializer_class = BookInfoSerializer</span><br><span class="line"></span><br><span class="line">    # detail为False 表示路径名格式应该为 books/latest/</span><br><span class="line">    @action(methods=[&#x27;get&#x27;], detail=False)</span><br><span class="line">    def latest(self, request):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        返回最新的图书信息</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    # detail为True，表示路径名格式应该为 books/&#123;pk&#125;/read/</span><br><span class="line">    @action(methods=[&#x27;put&#x27;], detail=True)</span><br><span class="line">    def read(self, request, pk):</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        修改图书的阅读量数据</span><br><span class="line">        &quot;&quot;&quot;</span><br><span class="line">        ...</span><br></pre></td></tr></table></figure>

<p>由路由器自动为此视图集自定义action方法形成的路由会是如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">^books/latest/$    name: book-latest</span><br><span class="line">^books/&#123;pk&#125;/read/$  name: book-read</span><br></pre></td></tr></table></figure>

<h4 id="3-5-3-路由router形成URL的方法"><a href="#3-5-3-路由router形成URL的方法" class="headerlink" title="3.5.3 路由router形成URL的方法"></a>3.5.3 路由router形成URL的方法</h4><p>1） SimpleRouter</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/16194/1671445017088/a16bf5dca5084794a9734c49c3c1de45.png" alt="image.png"></p>
<p>2）DefaultRouter</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/16194/1671445017088/c4af57783b814f24b9f5c455111a05b1.png" alt="image.png"></p>
<p>DefaultRouter与SimpleRouter的区别是，DefaultRouter会多附带一个默认的API根视图，返回一个包含所有列表视图的超链接响应数据。</p>
<h2 id="4-JWT"><a href="#4-JWT" class="headerlink" title="4 JWT"></a>4 JWT</h2><p>JWT<br>JSON Web Token（JSON Web令牌）</p>
<p>是一个开放标准(rfc7519)，它定义了一种紧凑的、自包含的方式，用于在各方之间以JSON对象安全地传输信息。此信息可以验证和信任，因为它是数字签名的。jwt可以使用秘密〈使用HNAC算法）或使用RSA或ECDSA的公钥&#x2F;私钥对进行签名。</p>
<p>通过JSON形式作为Web应用中的令牌，用于在各方之间安全地将信息作为JSON对象传输。在数据传输过程中还可以完成数据加密、签名等相关处理。</p>
<p>JWT作用：<br>授权：一旦用户登录，每个后续请求将包括JWT，从而允许用户访问该令牌允许的路由，服务和资源。它的开销很小并且可以在不同的域中使用。如：单点登录。<br>信息交换：在各方之间安全地传输信息。JWT可进行签名（如使用公钥&#x2F;私钥对)，因此可确保发件人。由于签名是使用标头和有效负载计算的，因此还可验证内容是否被篡改。<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img-blog.csdn/img.cn/20201029154848467.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1RvcF9MMzk4,size_16,color_FFFFFF,t_70#pic_center" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(/img-4Njwu2Yt-1603957559915)(E:/LiuPengLearn/LiuP%E7%9A%84%E7%BC%96%E7%A8%8B%E4%B9%8B%E8%B7%AF/Java%E6%8A%80%E6%9C%AF%E6%95%B4%E5%90%88/JWT/images/image-20200917201624900.png)]"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://fynotefile.oss-cn-zhangjiakou.aliyuncs.com/fynote/fyfile/482/1620998133146189824/98a020d466004863ac8da862b296cbae.png" alt="image.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1) jwt = base64(头部).base(载荷).hash256(base64(头部).base(载荷).密钥)</span><br><span class="line">2) base64是可逆的算法、hash256是不可逆的算法</span><br><span class="line">3) 密钥是固定的字符串，保存在服务器</span><br></pre></td></tr></table></figure>

<h3 id="4-1-DRF-JWT"><a href="#4-1-DRF-JWT" class="headerlink" title="4.1 DRF-JWT"></a>4.1 DRF-JWT</h3><p>官网：<a target="_blank" rel="noopener external nofollow noreferrer" href="http://getblimp.github.io/django-rest-framework-jwt/">http://getblimp.github.io/django-rest-framework-jwt/</a></p>
<h4 id="4-1-1-安装"><a href="#4-1-1-安装" class="headerlink" title="4.1.1 安装"></a>4.1.1 安装</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install djangorestframework-jwt</span><br></pre></td></tr></table></figure>

<h4 id="4-1-2-使用"><a href="#4-1-2-使用" class="headerlink" title="4.1.2 使用"></a>4.1.2 使用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from django.urls import path</span><br><span class="line">from rest_framework_jwt.views import obtain_jwt_token</span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(&#x27;login/&#x27;, obtain_jwt_token),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h4 id="4-1-3-测试"><a href="#4-1-3-测试" class="headerlink" title="4.1.3 测试"></a>4.1.3 测试</h4><p>(案例需要提前准备）</p>
<h4 id="4-1-4-DRF-JWT开发"><a href="#4-1-4-DRF-JWT开发" class="headerlink" title="4.1.4 DRF-JWT开发"></a>4.1.4 DRF-JWT开发</h4><p>配置信息：JWT_auth到dev.py中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import datetime</span><br><span class="line">JWT_AUTH = &#123;</span><br><span class="line">    # 过期时间</span><br><span class="line">    &#x27;JWT_EXPIRATION_DELTA&#x27;: datetime.timedelta(days=1),</span><br><span class="line">    # 自定义认证结果：见下方序列化user和自定义response</span><br><span class="line">    &#x27;JWT_RESPONSE_PAYLOAD_HANDLER&#x27;: &#x27;user.utils.jwt_response_payload_handler&#x27;,  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>序列化user：user&#x2F;serializers.py(自己创建)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework import serializers</span><br><span class="line">from . import models</span><br><span class="line">class UserModelSerializers(serializers.ModelSerializer):</span><br><span class="line">    class Meta:</span><br><span class="line">        model = models.User</span><br><span class="line">        fields = [&#x27;username&#x27;]</span><br></pre></td></tr></table></figure>

<p>自定义response：user&#x2F;utils.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">from .serializers import UserModelSerializers</span><br><span class="line">def jwt_response_payload_handler(token, user=None, request=None):</span><br><span class="line">    return &#123;</span><br><span class="line">        &#x27;status&#x27;: 0,</span><br><span class="line">        &#x27;msg&#x27;: &#x27;ok&#x27;,</span><br><span class="line">        &#x27;data&#x27;: &#123;</span><br><span class="line">            &#x27;token&#x27;: token,</span><br><span class="line">            &#x27;user&#x27;: UserModelSerializers(user).data</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>基于drf-jwt的全局认证：user&#x2F;authentications.py（自己创建）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import jwt</span><br><span class="line">from rest_framework.exceptions import AuthenticationFailed</span><br><span class="line">from rest_framework_jwt.authentication import jwt_decode_handler</span><br><span class="line">from rest_framework_jwt.authentication import get_authorization_header</span><br><span class="line">from rest_framework_jwt.authentication import BaseJSONWebTokenAuthentication</span><br><span class="line"></span><br><span class="line">class JSONWebTokenAuthentication(BaseJSONWebTokenAuthentication):</span><br><span class="line">    def authenticate(self, request):</span><br><span class="line">        jwt_value = get_authorization_header(request)</span><br><span class="line"></span><br><span class="line">        if not jwt_value:</span><br><span class="line">            raise AuthenticationFailed(&#x27;Authorization 字段是必须的&#x27;)</span><br><span class="line">        try:</span><br><span class="line">            payload = jwt_decode_handler(jwt_value)</span><br><span class="line">        except jwt.ExpiredSignature:</span><br><span class="line">            raise AuthenticationFailed(&#x27;签名过期&#x27;)</span><br><span class="line">        except jwt.InvalidTokenError:</span><br><span class="line">            raise AuthenticationFailed(&#x27;非法用户&#x27;)</span><br><span class="line">        user = self.authenticate_credentials(payload)</span><br><span class="line"></span><br><span class="line">        return user, jwt_value</span><br></pre></td></tr></table></figure>

<p>全局启用：settings&#x2F;dev.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123;</span><br><span class="line">    # 认证模块</span><br><span class="line">    &#x27;DEFAULT_AUTHENTICATION_CLASSES&#x27;: (</span><br><span class="line">        &#x27;user.authentications.JSONWebTokenAuthentication&#x27;,</span><br><span class="line">	# DRF自带的JWT认证模块</span><br><span class="line">	#&#x27;rest_framework_jwt.authentication.JSONWebTokenAuthentication&#x27;,</span><br><span class="line">    ),</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>局部启用禁用：任何一个cvb类首行设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 局部禁用</span><br><span class="line">authentication_classes = []</span><br><span class="line"></span><br><span class="line"># 局部启用</span><br><span class="line">from user.authentications import JSONWebTokenAuthentication</span><br><span class="line">authentication_classes = [JSONWebTokenAuthentication]</span><br></pre></td></tr></table></figure>

<p>自定义代码登录：user&#x2F;utils.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">from .models import User</span><br><span class="line">from django.contrib.auth.backends import ModelBackend</span><br><span class="line">class JWTModelBackend(ModelBackend):</span><br><span class="line">    def authenticate(self, request, username=None, password=None, **kwargs):</span><br><span class="line">        try:</span><br><span class="line">            if re.match(r&#x27;^1[3-9]\d&#123;9&#125;$&#x27;, username):</span><br><span class="line">                user = User.objects.get(mobile=username)</span><br><span class="line">            else:</span><br><span class="line">                user = User.objects.get(username=username)</span><br><span class="line">        except User.DoesNotExist:</span><br><span class="line">            return None</span><br><span class="line">        if user.check_password(password) and self.user_can_authenticate(user):</span><br><span class="line">            return user</span><br></pre></td></tr></table></figure>

<p>配置自定义登录：settings&#x2F;dev.py</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AUTHENTICATION_BACKENDS = [&#x27;user.utils.JWTModelBackend&#x27;]</span><br></pre></td></tr></table></figure>

<p>手动签发JWT：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">from rest_framework_jwt.settings import api_settings</span><br><span class="line"></span><br><span class="line">jwt_payload_handler = api_settings.JWT_PAYLOAD_HANDLER</span><br><span class="line">jwt_encode_handler = api_settings.JWT_ENCODE_HANDLER</span><br><span class="line"></span><br><span class="line">payload = jwt_payload_handler(user)</span><br><span class="line">token = jwt_encode_handler(payload)</span><br></pre></td></tr></table></figure>

<h2 id="5-Django-DRF序列化器-Serializer"><a href="#5-Django-DRF序列化器-Serializer" class="headerlink" title="5 Django DRF序列化器 Serializer"></a>5 Django DRF序列化器 Serializer</h2><h3 id="5-1-定义序列化器"><a href="#5-1-定义序列化器" class="headerlink" title="5.1 定义序列化器"></a>5.1 定义序列化器</h3><p>Django REST framework中的Serializer使用类来定义，须继承自rest_framework.serializers.Serializer。</p>
<p>例如，我们已有了一个数据库模型类BookInfo</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class BookInfo(models.Model):</span><br><span class="line">    btitle = models.CharField(max_length=20, verbose_name=&#x27;名称&#x27;)</span><br><span class="line">    bpub_date = models.DateField(verbose_name=&#x27;发布日期&#x27;, null=True)</span><br><span class="line">    bread = models.IntegerField(default=0, verbose_name=&#x27;阅读量&#x27;)</span><br><span class="line">    bcomment = models.IntegerField(default=0, verbose_name=&#x27;评论量&#x27;)</span><br><span class="line">    image = models.ImageField(upload_to=&#x27;booktest&#x27;, verbose_name=&#x27;图片&#x27;, null=True)</span><br></pre></td></tr></table></figure>

<p>我们想为这个模型类提供一个序列化器，可以定义如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class BookInfoSerializer(serializers.Serializer):</span><br><span class="line">    &quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span><br><span class="line">    id = serializers.IntegerField(label=&#x27;ID&#x27;, read_only=True)</span><br><span class="line">    btitle = serializers.CharField(label=&#x27;名称&#x27;, max_length=20)</span><br><span class="line">    bpub_date = serializers.DateField(label=&#x27;发布日期&#x27;, required=False)</span><br><span class="line">    bread = serializers.IntegerField(label=&#x27;阅读量&#x27;, required=False)</span><br><span class="line">    bcomment = serializers.IntegerField(label=&#x27;评论量&#x27;, required=False)</span><br><span class="line">    image = serializers.ImageField(label=&#x27;图片&#x27;, required=False)</span><br></pre></td></tr></table></figure>

<p><strong>注意：serializer不是只能为数据库模型类定义，也可以为非数据库模型类的数据定义。</strong> serializer是独立于数据库之外的存在。</p>
<h4 id="常用字段类型"><a href="#常用字段类型" class="headerlink" title="常用字段类型"></a>常用字段类型</h4><p><strong>常用字段类型</strong> ：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>字段构造方式</th>
</tr>
</thead>
<tbody><tr>
<td><strong>BooleanField</strong></td>
<td>BooleanField()</td>
</tr>
<tr>
<td><strong>NullBooleanField</strong></td>
<td>NullBooleanField()</td>
</tr>
<tr>
<td><strong>CharField</strong></td>
<td>CharField(max_length&#x3D;None, min_length&#x3D;None, allow_blank&#x3D;False, trim_whitespace&#x3D;True)</td>
</tr>
<tr>
<td><strong>EmailField</strong></td>
<td>EmailField(max_length&#x3D;None, min_length&#x3D;None, allow_blank&#x3D;False)</td>
</tr>
<tr>
<td><strong>RegexField</strong></td>
<td>RegexField(regex, max_length&#x3D;None, min_length&#x3D;None, allow_blank&#x3D;False)</td>
</tr>
<tr>
<td><strong>SlugField</strong></td>
<td>SlugField(max_length&#x3D;50, min_length&#x3D;None, allow_blank&#x3D;False) 正则字段，验证正则模式 [a-zA-Z0-9*-]+</td>
</tr>
<tr>
<td><strong>URLField</strong></td>
<td>URLField(max_length&#x3D;200, min_length&#x3D;None, allow_blank&#x3D;False)</td>
</tr>
<tr>
<td><strong>UUIDField</strong></td>
<td>UUIDField(format&#x3D;’hex_verbose’) format: 1)<code>&#39;hex_verbose&#39;</code> 如 <code>&quot;5ce0e9a5-5ffa-654b-cee0-1238041fb31a&quot;</code> 2） <code>&#39;hex&#39;</code> 如 <code>&quot;5ce0e9a55ffa654bcee01238041fb31a&quot;</code> 3）<code>&#39;int&#39;</code> - 如: <code>&quot;123456789012312313134124512351145145114&quot;</code> 4）<code>&#39;urn&#39;</code> 如: <code>&quot;urn:uuid:5ce0e9a5-5ffa-654b-cee0-1238041fb31a&quot;</code></td>
</tr>
<tr>
<td><strong>IPAddressField</strong></td>
<td>IPAddressField(protocol&#x3D;’both’, unpack_ipv4&#x3D;False, **options)</td>
</tr>
<tr>
<td><strong>IntegerField</strong></td>
<td>IntegerField(max_value&#x3D;None, min_value&#x3D;None)</td>
</tr>
<tr>
<td><strong>FloatField</strong></td>
<td>FloatField(max_value&#x3D;None, min_value&#x3D;None)</td>
</tr>
<tr>
<td><strong>DecimalField</strong></td>
<td>DecimalField(max_digits, decimal_places, coerce_to_string&#x3D;None, max_value&#x3D;None, min_value&#x3D;None) max_digits: 最多位数 decimal_palces: 小数点位置</td>
</tr>
<tr>
<td><strong>DateTimeField</strong></td>
<td>DateTimeField(format&#x3D;api_settings.DATETIME_FORMAT, input_formats&#x3D;None)</td>
</tr>
<tr>
<td><strong>DateField</strong></td>
<td>DateField(format&#x3D;api_settings.DATE_FORMAT, input_formats&#x3D;None)</td>
</tr>
<tr>
<td><strong>TimeField</strong></td>
<td>TimeField(format&#x3D;api_settings.TIME_FORMAT, input_formats&#x3D;None)</td>
</tr>
<tr>
<td><strong>DurationField</strong></td>
<td>DurationField()</td>
</tr>
<tr>
<td><strong>ChoiceField</strong></td>
<td>ChoiceField(choices) choices与Django的用法相同</td>
</tr>
<tr>
<td><strong>MultipleChoiceField</strong></td>
<td>MultipleChoiceField(choices)</td>
</tr>
<tr>
<td><strong>FileField</strong></td>
<td>FileField(max_length&#x3D;None, allow_empty_file&#x3D;False, use_url&#x3D;UPLOADED_FILES_USE_URL)</td>
</tr>
<tr>
<td><strong>ImageField</strong></td>
<td>ImageField(max_length&#x3D;None, allow_empty_file&#x3D;False, use_url&#x3D;UPLOADED_FILES_USE_URL)</td>
</tr>
<tr>
<td><strong>ListField</strong></td>
<td>ListField(child&#x3D;, min_length&#x3D;None, max_length&#x3D;None)</td>
</tr>
<tr>
<td><strong>DictField</strong></td>
<td>DictField(child&#x3D;)</td>
</tr>
</tbody></table>
<h4 id="选项参数"><a href="#选项参数" class="headerlink" title="选项参数"></a>选项参数</h4><p><strong>选项参数：</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><strong>max_length</strong></td>
<td>最大长度</td>
</tr>
<tr>
<td><strong>min_lenght</strong></td>
<td>最小长度</td>
</tr>
<tr>
<td><strong>allow_blank</strong></td>
<td>是否允许为空</td>
</tr>
<tr>
<td><strong>trim_whitespace</strong></td>
<td>是否截断空白字符</td>
</tr>
<tr>
<td><strong>max_value</strong></td>
<td>最小值</td>
</tr>
<tr>
<td><strong>min_value</strong></td>
<td>最大值</td>
</tr>
</tbody></table>
<h4 id="通用参数"><a href="#通用参数" class="headerlink" title="通用参数"></a>通用参数</h4><table>
<thead>
<tr>
<th>参数名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>read_only</strong></td>
<td>表明该字段仅用于序列化输出，默认False</td>
</tr>
<tr>
<td><strong>write_only</strong></td>
<td>表明该字段仅用于反序列化输入，默认False</td>
</tr>
<tr>
<td><strong>required</strong></td>
<td>表明该字段在反序列化时必须输入，默认True</td>
</tr>
<tr>
<td><strong>default</strong></td>
<td>反序列化时使用的默认值</td>
</tr>
<tr>
<td><strong>allow_null</strong></td>
<td>表明该字段是否允许传入None，默认False</td>
</tr>
<tr>
<td><strong>validators</strong></td>
<td>该字段使用的验证器</td>
</tr>
<tr>
<td><strong>error_messages</strong></td>
<td>包含错误编号与错误信息的字典</td>
</tr>
<tr>
<td><strong>label</strong></td>
<td>用于HTML展示API页面时，显示的字段名称</td>
</tr>
<tr>
<td><strong>help_text</strong></td>
<td>用于HTML展示API页面时，显示的字段帮助提示信息</td>
</tr>
</tbody></table>
<h3 id="5-2-创建Serializer对象"><a href="#5-2-创建Serializer对象" class="headerlink" title="5.2 创建Serializer对象"></a>5.2 创建Serializer对象</h3><p>序列化器有四大功能：</p>
<ul>
<li>反序列化 ： 把请求（request）中参数(字典) —–&gt; （模型）对象</li>
<li>请求参数校验 ：</li>
<li>保存和修改模型对象（数据库）：save</li>
<li>序列化： 把（模型）对象 ——&gt; 字典（—–&gt;json由response来完成）</li>
</ul>
<p>定义好Serializer类后，就可以创建Serializer对象了。</p>
<p>Serializer的构造方法为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Serializer(instance=None, data=empty, **kwarg)</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<p>1）用于序列化时，将模型类对象传入<strong>instance</strong>参数</p>
<p>2）用于反序列化时，将要被反序列化的数据传入<strong>data</strong>参数</p>
<p>3）除了instance和data参数外，在构造Serializer对象时，还可通过<strong>context</strong>参数额外添加数据，如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">serializer = AccountSerializer(account, context=&#123;&#x27;request&#x27;: request&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>通过context参数附加的数据，可以通过Serializer对象的context属性获取。</strong></p>
<ol>
<li>使用序列化器的时候一定要注意，序列化器声明了以后，不会自动执行，需要我们在视图中进行调用才可以。</li>
<li>序列化器无法直接接收数据，需要我们在视图中创建序列化器对象时把使用的数据传递过来。</li>
<li>序列化器的字段声明类似于我们前面使用过的表单系统。</li>
<li>开发restful api时，序列化器会帮我们把模型数据转换成字典.</li>
<li>drf提供的视图会帮我们把字典转换成json,或者把客户端发送过来的数据转换字典.</li>
</ol>
<p>序列化器的使用分两个阶段：</p>
<ol>
<li>在客户端请求时，使用序列化器可以完成对数据的反序列化。</li>
<li>在服务器响应时，使用序列化器可以完成对数据的序列化。</li>
</ol>
<h3 id="5-3-序列化"><a href="#5-3-序列化" class="headerlink" title="5.3 序列化"></a>5.3 序列化</h3><h4 id="5-3-1-基本使用"><a href="#5-3-1-基本使用" class="headerlink" title="5.3.1 基本使用"></a>5.3.1 基本使用</h4><p>(1) 先查询出一个图书对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from booktest.models import BookInfo</span><br><span class="line"></span><br><span class="line">book = BookInfo.objects.get(id=2)</span><br></pre></td></tr></table></figure>

<p>(2) 构造序列化对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from booktest.serializers import BookInfoSerializer</span><br><span class="line"></span><br><span class="line">serializer = BookInfoSerializer(book)</span><br></pre></td></tr></table></figure>

<p>(3) 获取序列化数据</p>
<p>通过data属性可以获取序列化后的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">serializer.data</span><br><span class="line"># &#123;&#x27;id&#x27;: 2, &#x27;btitle&#x27;: &#x27;天龙八部&#x27;, &#x27;bpub_date&#x27;: &#x27;1986-07-24&#x27;, &#x27;bread&#x27;: 36, &#x27;bcomment&#x27;: 40, &#x27;image&#x27;: None&#125;</span><br></pre></td></tr></table></figure>

<p>(4) 如果要被序列化的是包含多条数据的查询集QuerySet，可以通过添加many&#x3D;True参数补充说明</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">book_qs = BookInfo.objects.all()</span><br><span class="line">serializer = BookInfoSerializer(book_qs, many=True)</span><br><span class="line">serializer.data</span><br><span class="line"># [OrderedDict([(&#x27;id&#x27;, 2), (&#x27;btitle&#x27;, &#x27;天龙八部&#x27;), (&#x27;bpub_date&#x27;, &#x27;1986-07-24&#x27;), (&#x27;bread&#x27;, 36), (&#x27;bcomment&#x27;, 40), (&#x27;image&#x27;, N]), OrderedDict([(&#x27;id&#x27;, 3), (&#x27;btitle&#x27;, &#x27;笑傲江湖&#x27;), (&#x27;bpub_date&#x27;, &#x27;1995-12-24&#x27;), (&#x27;bread&#x27;, 20), (&#x27;bcomment&#x27;, 80), (&#x27;image&#x27;ne)]), OrderedDict([(&#x27;id&#x27;, 4), (&#x27;btitle&#x27;, &#x27;雪山飞狐&#x27;), (&#x27;bpub_date&#x27;, &#x27;1987-11-11&#x27;), (&#x27;bread&#x27;, 58), (&#x27;bcomment&#x27;, 24), (&#x27;ima None)]), OrderedDict([(&#x27;id&#x27;, 5), (&#x27;btitle&#x27;, &#x27;西游记&#x27;), (&#x27;bpub_date&#x27;, &#x27;1988-01-01&#x27;), (&#x27;bread&#x27;, 10), (&#x27;bcomment&#x27;, 10), (&#x27;im&#x27;, &#x27;booktest/xiyouji.png&#x27;)])]</span><br></pre></td></tr></table></figure>

<h3 id="5-4-反序列化"><a href="#5-4-反序列化" class="headerlink" title="5.4 反序列化"></a>5.4 反序列化</h3><p>进行反序列化之前，必须先进行数据验证</p>
<p>使用序列化器进行反序列化时，需要对数据进行验证后，才能获取验证成功的数据或保存成模型类对象。</p>
<p>在获取反序列化的数据前，必须调用 <strong>is_valid()</strong> 方法进行验证，验证成功返回True，否则返回False。</p>
<p>验证失败，可以通过序列化器对象的<strong>errors</strong>属性获取错误信息，返回字典，包含了字段和字段的错误。如果是非字段错误，可以通过修改REST framework配置中的<strong>NON_FIELD_ERRORS_KEY</strong>来控制错误字典中的键名。</p>
<p>验证成功，可以通过序列化器对象的<strong>validated_data</strong>属性获取数据。</p>
<p>在定义序列化器时，指明每个字段的序列化类型和选项参数，本身就是一种验证行为。</p>
<p>如我们前面定义过的BookInfoSerializer</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class BookInfoSerializer(serializers.Serializer):</span><br><span class="line">    &quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span><br><span class="line">    id = serializers.IntegerField(label=&#x27;ID&#x27;, read_only=True)</span><br><span class="line">    btitle = serializers.CharField(label=&#x27;名称&#x27;, max_length=20)</span><br><span class="line">    bpub_date = serializers.DateField(label=&#x27;发布日期&#x27;, required=False)</span><br><span class="line">    bread = serializers.IntegerField(label=&#x27;阅读量&#x27;, required=False)</span><br><span class="line">    bcomment = serializers.IntegerField(label=&#x27;评论量&#x27;, required=False)</span><br><span class="line">    image = serializers.ImageField(label=&#x27;图片&#x27;, required=False)</span><br></pre></td></tr></table></figure>

<p>通过构造序列化器对象，并将要反序列化的数据传递给data构造参数，进而进行验证</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from booktest.serializers import BookInfoSerializer</span><br><span class="line">data = &#123;&#x27;bpub_date&#x27;: 123&#125;</span><br><span class="line">serializer = BookInfoSerializer(data=data)</span><br><span class="line">serializer.is_valid()  # 返回False</span><br><span class="line">serializer.errors</span><br><span class="line"># &#123;&#x27;btitle&#x27;: [ErrorDetail(string=&#x27;This field is required.&#x27;, code=&#x27;required&#x27;)], &#x27;bpub_date&#x27;: [ErrorDetail(string=&#x27;Date has wrong format. Use one of these formats instead: YYYY[-MM[-DD]].&#x27;, code=&#x27;invalid&#x27;)]&#125;</span><br><span class="line">serializer.validated_data  # &#123;&#125;</span><br><span class="line"></span><br><span class="line">data = &#123;&#x27;btitle&#x27;: &#x27;python&#x27;&#125;</span><br><span class="line">serializer = BookInfoSerializer(data=data)</span><br><span class="line">serializer.is_valid()  # True</span><br><span class="line">serializer.errors  # &#123;&#125;</span><br><span class="line">serializer.validated_data  #  OrderedDict([(&#x27;btitle&#x27;, &#x27;python&#x27;)])</span><br></pre></td></tr></table></figure>

<p>is_valid()方法还可以在验证失败时抛出异常serializers.ValidationError，可以通过传递<strong>raise_exception&#x3D;True</strong>参数开启，REST framework接收到此异常，会向前端返回HTTP 400 Bad Request响应。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Return a 400 response if the data was invalid.</span><br><span class="line">serializer.is_valid(raise_exception=True)</span><br></pre></td></tr></table></figure>

<p>(1) validate_字段名</p>
<p>对<field_name>字典进行验证，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class BookInfoSerializer(serializers.Serializer):</span><br><span class="line">    &quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    def validate_btitle(self, value):</span><br><span class="line">        if &#x27;django&#x27; not in value.lower():</span><br><span class="line">            raise serializers.ValidationError(&quot;图书不是关于Django的&quot;)</span><br><span class="line">        return value</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from booktest.serializers import BookInfoSerializer</span><br><span class="line">data = &#123;&#x27;btitle&#x27;: &#x27;python&#x27;&#125;</span><br><span class="line">serializer = BookInfoSerializer(data=data)</span><br><span class="line">serializer.is_valid()  # False   </span><br><span class="line">serializer.errors</span><br><span class="line">#  &#123;&#x27;btitle&#x27;: [ErrorDetail(string=&#x27;图书不是关于Django的&#x27;, code=&#x27;invalid&#x27;)]&#125;</span><br></pre></td></tr></table></figure>

<p>(2) validate</p>
<p>在序列化器中需要同时对多个字段进行比较验证时，可以定义validate方法来验证，如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from booktest.serializers import BookInfoSerializer</span><br><span class="line">data = &#123;&#x27;btitle&#x27;: &#x27;about django&#x27;, &#x27;bread&#x27;: 10, &#x27;bcomment&#x27;: 20&#125;</span><br><span class="line">s = BookInfoSerializer(data=data)</span><br><span class="line">s.is_valid()  # False</span><br><span class="line">s.errors</span><br><span class="line">#  &#123;&#x27;non_field_errors&#x27;: [ErrorDetail(string=&#x27;阅读量小于评论量&#x27;, code=&#x27;invalid&#x27;)]&#125;</span><br></pre></td></tr></table></figure>

<p>(3) validators</p>
<p>在字段中添加validators选项参数，也可以补充验证行为，如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def about_django(value):</span><br><span class="line">    if &#x27;django&#x27; not in value.lower():</span><br><span class="line">        raise serializers.ValidationError(&quot;图书不是关于Django的&quot;)</span><br><span class="line"></span><br><span class="line">class BookInfoSerializer(serializers.Serializer):</span><br><span class="line">    &quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span><br><span class="line">    id = serializers.IntegerField(label=&#x27;ID&#x27;, read_only=True)</span><br><span class="line">    btitle = serializers.CharField(label=&#x27;名称&#x27;, max_length=20, validators=[about_django])</span><br><span class="line">    bpub_date = serializers.DateField(label=&#x27;发布日期&#x27;, required=False)</span><br><span class="line">    bread = serializers.IntegerField(label=&#x27;阅读量&#x27;, required=False)</span><br><span class="line">    bcomment = serializers.IntegerField(label=&#x27;评论量&#x27;, required=False)</span><br><span class="line">    image = serializers.ImageField(label=&#x27;图片&#x27;, required=False)</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">from booktest.serializers import BookInfoSerializer</span><br><span class="line">data = &#123;&#x27;btitle&#x27;: &#x27;python&#x27;&#125;</span><br><span class="line">serializer = BookInfoSerializer(data=data)</span><br><span class="line">serializer.is_valid()  # False   </span><br><span class="line">serializer.errors</span><br><span class="line">#  &#123;&#x27;btitle&#x27;: [ErrorDetail(string=&#x27;图书不是关于Django的&#x27;, code=&#x27;invalid&#x27;)]&#125;</span><br></pre></td></tr></table></figure>

<h3 id="反序列化-保存数据"><a href="#反序列化-保存数据" class="headerlink" title="反序列化-保存数据"></a>反序列化-保存数据</h3><p>前面的验证数据成功后,我们可以使用序列化器来完成数据反序列化的过程.这个过程可以把数据转成模型类对象.</p>
<p>可以通过实现create()和update()两个方法来实现。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class BookInfoSerializer(serializers.Serializer):</span><br><span class="line">    &quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    def create(self, validated_data):</span><br><span class="line">        &quot;&quot;&quot;新建&quot;&quot;&quot;</span><br><span class="line">        return BookInfo(**validated_data)</span><br><span class="line"></span><br><span class="line">    def update(self, instance, validated_data):</span><br><span class="line">        &quot;&quot;&quot;更新，instance为要更新的对象实例&quot;&quot;&quot;</span><br><span class="line">        instance.btitle = validated_data.get(&#x27;btitle&#x27;, instance.btitle)</span><br><span class="line">        instance.bpub_date = validated_data.get(&#x27;bpub_date&#x27;, instance.bpub_date)</span><br><span class="line">        instance.bread = validated_data.get(&#x27;bread&#x27;, instance.bread)</span><br><span class="line">        instance.bcomment = validated_data.get(&#x27;bcomment&#x27;, instance.bcomment)</span><br><span class="line">        return instance</span><br></pre></td></tr></table></figure>

<p>如果需要在返回数据对象的时候，也将数据保存到数据库中，则可以进行如下修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">class BookInfoSerializer(serializers.Serializer):</span><br><span class="line">    &quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    def create(self, validated_data):</span><br><span class="line">        &quot;&quot;&quot;新建&quot;&quot;&quot;</span><br><span class="line">        return BookInfo.objects.create(**validated_data)</span><br><span class="line"></span><br><span class="line">    def update(self, instance, validated_data):</span><br><span class="line">        &quot;&quot;&quot;更新，instance为要更新的对象实例&quot;&quot;&quot;</span><br><span class="line">        instance.btitle = validated_data.get(&#x27;btitle&#x27;, instance.btitle)</span><br><span class="line">        instance.bpub_date = validated_data.get(&#x27;bpub_date&#x27;, instance.bpub_date)</span><br><span class="line">        instance.bread = validated_data.get(&#x27;bread&#x27;, instance.bread)</span><br><span class="line">        instance.bcomment = validated_data.get(&#x27;bcomment&#x27;, instance.bcomment)</span><br><span class="line">        instance.save()</span><br><span class="line">        return instance</span><br></pre></td></tr></table></figure>

<p>实现了上述两个方法后，在反序列化数据的时候，就可以通过save()方法返回一个数据对象实例了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">book = serializer.save()</span><br></pre></td></tr></table></figure>

<p>如果创建序列化器对象的时候，没有传递instance实例，则调用save()方法的时候，create()被调用，相反，如果传递了instance实例，则调用save()方法的时候，update()被调用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from db.serializers import BookInfoSerializer</span><br><span class="line">data = &#123;&#x27;btitle&#x27;: &#x27;封神演义&#x27;&#125;</span><br><span class="line">serializer = BookInfoSerializer(data=data)</span><br><span class="line">serializer.is_valid()  # True</span><br><span class="line">serializer.save()  # &lt;BookInfo: 封神演义&gt;</span><br><span class="line"></span><br><span class="line">from db.models import BookInfo</span><br><span class="line">book = BookInfo.objects.get(id=2)</span><br><span class="line">data = &#123;&#x27;btitle&#x27;: &#x27;倚天剑&#x27;&#125;</span><br><span class="line">serializer = BookInfoSerializer(book, data=data)</span><br><span class="line">serializer.is_valid()  # True</span><br><span class="line">serializer.save()  # &lt;BookInfo: 倚天剑&gt;</span><br><span class="line">book.btitle  # &#x27;倚天剑&#x27;</span><br></pre></td></tr></table></figure>

<p>说明：</p>
<p>（1）在对序列化器进行save()保存时，可以额外传递数据，这些数据可以在create()和update()中的validated_data参数获取到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># request.user 是django中记录当前登录用户的模型对象</span><br><span class="line">serializer.save(owner=request.user)</span><br></pre></td></tr></table></figure>

<p>（2）默认序列化器必须传递所有required的字段，否则会抛出验证异常。但是我们可以使用partial参数来允许部分字段更新</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Update `comment` with partial data</span><br><span class="line">serializer = CommentSerializer(comment, data=&#123;&#x27;content&#x27;: u&#x27;foo bar&#x27;&#125;, partial=True)</span><br></pre></td></tr></table></figure>

<h3 id="模型类序列化器"><a href="#模型类序列化器" class="headerlink" title="模型类序列化器"></a>模型类序列化器</h3><p>如果我们想要使用序列化器对应的是Django的模型类，DRF为我们提供了ModelSerializer模型类序列化器来帮助我们快速创建一个Serializer类。</p>
<p>ModelSerializer与常规的Serializer相同，但提供了：</p>
<ul>
<li>基于模型类自动生成一系列字段</li>
<li>基于模型类自动为Serializer生成validators，比如unique_together</li>
<li>包含默认的create()和update()的实现</li>
</ul>
<h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>比如我们创建一个BookInfoSerializer</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class BookInfoSerializer(serializers.ModelSerializer):</span><br><span class="line">    &quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span><br><span class="line">    class Meta:</span><br><span class="line">        model = BookInfo</span><br><span class="line">        fields = &#x27;__all__&#x27;</span><br></pre></td></tr></table></figure>

<ul>
<li>model 指明参照哪个模型类</li>
<li>fields 指明为模型类的哪些字段生成</li>
</ul>
<p>我们可以在python manage.py shell中查看自动生成的BookInfoSerializer的具体实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from booktest.serializers import BookInfoSerializer</span><br><span class="line">&gt;&gt;&gt; serializer = BookInfoSerializer()</span><br><span class="line">&gt;&gt;&gt; serializer</span><br><span class="line">BookInfoSerializer():</span><br><span class="line">    id = IntegerField(label=&#x27;ID&#x27;, read_only=True)</span><br><span class="line">    btitle = CharField(label=&#x27;名称&#x27;, max_length=20)</span><br><span class="line">    bpub_date = DateField(allow_null=True, label=&#x27;发布日期&#x27;, required=False)</span><br><span class="line">    bread = IntegerField(label=&#x27;阅读量&#x27;, max_value=2147483647, min_value=-2147483648, required=False)</span><br><span class="line">    bcomment = IntegerField(label=&#x27;评论量&#x27;, max_value=2147483647, min_value=-2147483648, required=False)</span><br><span class="line">    image = ImageField(allow_null=True, label=&#x27;图片&#x27;, max_length=100, required=False)</span><br></pre></td></tr></table></figure>

<h4 id="指定字段"><a href="#指定字段" class="headerlink" title="指定字段"></a>指定字段</h4><p>使用<strong>fields</strong>来明确字段，<code>__all__</code>表名包含所有字段，也可以写明具体哪些字段，如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class BookInfoSerializer(serializers.ModelSerializer):</span><br><span class="line">    &quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span><br><span class="line">    class Meta:</span><br><span class="line">        model = BookInfo</span><br><span class="line">        fields = (&#x27;id&#x27;, &#x27;btitle&#x27;, &#x27;bpub_date&#x27;)</span><br></pre></td></tr></table></figure>

<p>使用exclude可以明确排序掉哪些字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class BookInfoSerializer(serializers.ModelSerializer):</span><br><span class="line">    &quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span><br><span class="line">    class Meta:</span><br><span class="line">        model = BookInfo</span><br><span class="line">        exclude = (&#x27;image&#x27;,)</span><br></pre></td></tr></table></figure>

<p>显示指明字段，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class HeroInfoSerializer(serializers.ModelSerializer):</span><br><span class="line">    hbook = BookInfoSerializer()</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        model = HeroInfo</span><br><span class="line">        fields = (&#x27;id&#x27;, &#x27;hname&#x27;, &#x27;hgender&#x27;, &#x27;hcomment&#x27;, &#x27;hbook&#x27;)</span><br></pre></td></tr></table></figure>

<p>指明只读字段</p>
<p>可以通过read_only_fields指明只读字段，既仅用于序列化输出的字段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class BookInfoSerializer(serializers.ModelSerializer):</span><br><span class="line">    &quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span><br><span class="line">    class Meta:</span><br><span class="line">        model = BookInfo</span><br><span class="line">        fields = (&#x27;id&#x27;, &#x27;btitle&#x27;, &#x27;bpub_date&#x27;， &#x27;bread&#x27;, &#x27;bcomment&#x27;)</span><br><span class="line">        read_only_fields = (&#x27;id&#x27;, &#x27;bread&#x27;, &#x27;bcomment&#x27;)</span><br></pre></td></tr></table></figure>

<h4 id="添加额外参数"><a href="#添加额外参数" class="headerlink" title="添加额外参数"></a>添加额外参数</h4><p>我们可以使用extra_kwargs参数为ModelSerializer添加或修改原有的选项参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class BookInfoSerializer(serializers.ModelSerializer):</span><br><span class="line">    &quot;&quot;&quot;图书数据序列化器&quot;&quot;&quot;</span><br><span class="line">    class Meta:</span><br><span class="line">        model = BookInfo</span><br><span class="line">        fields = (&#x27;id&#x27;, &#x27;btitle&#x27;, &#x27;bpub_date&#x27;, &#x27;bread&#x27;, &#x27;bcomment&#x27;)</span><br><span class="line">        extra_kwargs = &#123;</span><br><span class="line">            &#x27;bread&#x27;: &#123;&#x27;min_value&#x27;: 0, &#x27;required&#x27;: True&#125;,</span><br><span class="line">            &#x27;bcomment&#x27;: &#123;&#x27;min_value&#x27;: 0, &#x27;required&#x27;: True&#125;,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"># BookInfoSerializer():</span><br><span class="line">#    id = IntegerField(label=&#x27;ID&#x27;, read_only=True)</span><br><span class="line">#    btitle = CharField(label=&#x27;名称&#x27;, max_length=20)</span><br><span class="line">#    bpub_date = DateField(allow_null=True, label=&#x27;发布日期&#x27;, required=False)</span><br><span class="line">#    bread = IntegerField(label=&#x27;阅读量&#x27;, max_value=2147483647, min_value=0, required=True)</span><br><span class="line">#    bcomment = IntegerField(label=&#x27;评论量&#x27;, max_value=2147483647, min_value=0, required=True)</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar/avatar01.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar/avatar01.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">月念尘</div><div class="post-copyright__author_desc">言念君子 温其如玉</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://ync.aqyync.top/1885882428/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://ync.aqyync.top/1885882428/')">DRF框架</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/img/reward/wechat2.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/reward/wechat2.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/reward/alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/reward/alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://ync.aqyync.top/1885882428/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=DRF框架&amp;url=https://ync.aqyync.top/1885882428/&amp;pic=/img/article_cover/DRF%E6%A1%86%E6%9E%B6.jpg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://ync.aqyync.top" target="_blank">YNCAQY</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/DRF%E6%A1%86%E6%9E%B6/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>DRF框架<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/img/default_cover5.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/3481172980/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/article_cover/image-20241029165207604-1730200485942-29.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">线性代数的解法</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/avatar/avatar01.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2021/01/15/f067ce69a5e09.png" alt="status"/></div></div><div class="author-info__description">月念尘</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/about"><h1 class="author-info__name">月念尘</h1><div class="author-info__desc">言念君子 温其如玉</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/yncaqy" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/544486480" rel="external nofollow noreferrer" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget" id="card-tuijian"><div id="tj-box"><div id="tj-box1"><div id="tj-left"><p>扫一扫</p>
<span>快速打开移动端➤</span></div><div id="tj-right"><div id="tj-img-box"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACBklEQVR42u3aQXKDMAwFUO5/6XTbmU7ol2WwSZ5XHRpAj4WtkXS8PnodeHh4eHh4eHh4eHh4eHh4eHh4eF/MO+L1+/d/7333tPPrYzHg4eHh7cD7Z9s95b2jVu/NY8DDw8Pbh5ccBueY/Pn9GPDw8PCewquGeH4FDw8P7xt4yZXzZz7m3MPDw8ObVIyoBpSk4xvVWvDw8PBuaYDN+nvT/h4eHh5eeyVpcRL0a+rCw8PDu5M3NkQ1Vobop+x4eHh4+/Cqj8sT9LEE+pJiBB4eHt6NvKO4+il49UPj4eHhreXNLUaMFY4vPBjw8PDwJvGS0PMRgf64QPmj4+Hh4S3i5QF10uix50yeKcPDw8O7YOhq7pGQlyEGW2h4eHh4t/PybTpJeTsbfV7UwMPDw1vF64TVT7iTu/Dw8PD2540dIWOB9kdd8fDw8O7n5Q3+uWH1xwXw8PDwVvGSA6DaxBr7TfJ2PDw8vH14HVJezkio1WQaDw8PbxWvemzkL662tcaoeHh4eHfyqht0tRl2fjBU/4uHh4e3D6+acHdGS/ODoXDw4OHh4S3ijbX8kxJGv/iLh4eH91xe/vrqR8kbY3h4eHhP5FWHq5LUuTNGgIeHh7eK1wkxCaU6QLCgjIuHh4d3cQNsbEPvtNbw8PDwduB9xsLDw8PDw8PDw8PDw8PDw8PDw8P7At4P/nbCRREMQ2AAAAAASUVORK5CYII="/></div></div></div><div id="tj-box2"><div id="tj-left"><p>扫一扫</p>
<span>下载移动端APP➤</span></div><div id="tj-right"><div id="tj-img-box"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACFklEQVR42u3aQY7DIBAEwPz/07vXSCuxPYPBxCmfoijBFAdm1PD6efTzwsPDw8PDw8PDw8PDw8PDw8PDw/ti3it+xv99/yZ/y/wc8PDw8O7i/bPt/vlNb6LXzgEPDw/vBN540uPfJGVj/N58Dnh4eHifyMub8nwEPDw8vGfzxlNcUXjw8PDwzuTlS9Db7j8ga8HDw8NbcAC27vMR53t4eHh4Aa/6VAPcvPmemhUeHh7eRl7v4D+/hpUfhlWLAR4eHt45vHxC1XHyq1pLshY8PDy8LTln/vpeY31Ve42Hh4e3k5dvwXm824sz8qM1PDw8vPN5veuq+Qi9sBgPDw/vXl4eoVbLwzjgyAvM1NUBPDw8vAW8maY2iTAS/PK6h4eHh7eMV72oWt7Eg4XIR8PDw8Pbz6se21fj2pvDCDw8PLwtvN42nV9sza8mFEoRHh4e3nZeQs0vUeXTnT8qw8PDwzuH12tzq8ddvdKCh4eHdw4vb4Lz9nq+kETLioeHh7eRV32qr58JNfDw8PDO5PWihyhaDYpBb8nw8PDwTuDNFINqC15dsovDCDw8PLxlMW5yhJ9v30nQsDxrwcPDw7uV11uCwiWqa8MIPDw8vMN4+abfKxI3tNR4eHh4l4YRvRGqW3/10ioeHh7efl6+NSdhRN5Aj0PbG8738PDw8ALeMx48PDw8PDw8PDw8PDw8PDw8PDy8L+D9Ajb+Qv1fy86LAAAAAElFTkSuQmCC"/></div></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#DRF%E6%A1%86%E6%9E%B6"><span class="toc-number">1.</span> <span class="toc-text">DRF框架</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-DRF%E5%85%A5%E9%97%A8"><span class="toc-number"></span> <span class="toc-text">1 DRF入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-RESTful"><span class="toc-number"></span> <span class="toc-text">1.1 RESTful</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-API%E6%8E%A5%E5%8F%A3%E5%92%8C-RESTful-API%E8%A7%84%E8%8C%83"><span class="toc-number"></span> <span class="toc-text">1.2 API接口和 RESTful API规范</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-Django-RESTful%E4%BB%8B%E7%BB%8D%E4%B8%8E%E5%AE%89%E8%A3%85"><span class="toc-number"></span> <span class="toc-text">1.3 Django-RESTful介绍与安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">1.3.1 介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-%E5%AE%89%E8%A3%85DRF"><span class="toc-number">2.</span> <span class="toc-text">1.3.2 安装DRF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-3-%E9%85%8D%E7%BD%AEDRF"><span class="toc-number">3.</span> <span class="toc-text">1.3.3 配置DRF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-4-serializer-py%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA%E5%BA%8F%E5%88%97%E5%8C%96%E7%B1%BB%EF%BC%88%E8%AF%A5%E6%96%87%E4%BB%B6%E4%B9%9F%E8%87%AA%E5%B7%B1%E5%88%9B%E5%BB%BA%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">1.3.4 serializer.py新建一个序列化类（该文件也自己创建）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-5-%E8%A7%86%E5%9B%BE%E7%B1%BB"><span class="toc-number">5.</span> <span class="toc-text">1.3.5 视图类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-6-%E7%BC%96%E5%86%99%E8%B7%AF%E7%94%B1"><span class="toc-number">6.</span> <span class="toc-text">1.3.6 编写路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-7-%E5%90%AF%E5%8A%A8%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%A7%8B%E6%B5%8B%E8%AF%95"><span class="toc-number">7.</span> <span class="toc-text">1.3.7 启动项目开始测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-DRF%E5%8A%9F%E8%83%BD%E7%BB%84%E4%BB%B6"><span class="toc-number"></span> <span class="toc-text">2 DRF功能组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E8%AE%A4%E8%AF%81Authentication"><span class="toc-number"></span> <span class="toc-text">2.1 认证Authentication</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-%E8%AE%A4%E8%AF%81%E9%85%8D%E7%BD%AE"><span class="toc-number">1.</span> <span class="toc-text">2.1.1 认证配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E8%AE%A4%E8%AF%81%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">2.1.2 认证使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-%E6%8F%90%E4%BE%9B%E7%9A%84%E6%9D%83%E9%99%90"><span class="toc-number">3.</span> <span class="toc-text">2.1.3 提供的权限</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9D%83%E9%99%90"><span class="toc-number">4.</span> <span class="toc-text">2.1.4 自定义权限</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E9%99%90%E6%B5%81Throttling"><span class="toc-number"></span> <span class="toc-text">2.2 限流Throttling</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-%E9%99%90%E6%B5%81%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">2.2.1 限流介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-%E9%99%90%E6%B5%81%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">2.2.2 限流使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-%E5%8F%AF%E9%80%89%E9%99%90%E6%B5%81%E7%B1%BB"><span class="toc-number">3.</span> <span class="toc-text">2.2.3 可选限流类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-%E6%A1%88%E4%BE%8B"><span class="toc-number">4.</span> <span class="toc-text">2.2.4 案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E8%BF%87%E6%BB%A4Filtering"><span class="toc-number"></span> <span class="toc-text">2.3 过滤Filtering</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text">2.3.1 基本用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-%E6%8E%92%E5%BA%8F"><span class="toc-number">2.</span> <span class="toc-text">2.3.2 排序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E5%88%86%E9%A1%B5"><span class="toc-number"></span> <span class="toc-text">2.4 分页</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text">2.4.1 基本用法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-%E5%8F%AF%E9%80%89%E5%88%86%E9%A1%B5%E5%99%A8"><span class="toc-number">2.</span> <span class="toc-text">2.4.2 可选分页器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86Exceptions"><span class="toc-number"></span> <span class="toc-text">2.5 异常处理Exceptions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3"><span class="toc-number"></span> <span class="toc-text">2.6 自动生成接口文档</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-1-%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96"><span class="toc-number">1.</span> <span class="toc-text">2.6.1 安装依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-2-%E8%AE%BE%E7%BD%AE%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E8%AE%BF%E9%97%AE%E8%B7%AF%E5%BE%84"><span class="toc-number">2.</span> <span class="toc-text">2.6.2 设置接口文档访问路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-3-%E6%96%87%E6%A1%A3%E6%8F%8F%E8%BF%B0%E8%AF%B4%E6%98%8E%E7%9A%84%E5%AE%9A%E4%B9%89%E4%BD%8D%E7%BD%AE"><span class="toc-number">3.</span> <span class="toc-text">2.6.3 文档描述说明的定义位置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-4-%E8%AE%BF%E9%97%AE%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3%E7%BD%91%E9%A1%B5"><span class="toc-number">4.</span> <span class="toc-text">2.6.4 访问接口文档网页</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-DRF%E8%A7%86%E5%9B%BE%E5%AE%B6%E6%97%8F"><span class="toc-number"></span> <span class="toc-text">3 DRF视图家族</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E4%B8%A4%E4%B8%AA%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%B1%BB"><span class="toc-number"></span> <span class="toc-text">3.1 两个视图基类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-APIView"><span class="toc-number">1.</span> <span class="toc-text">3.1.1 APIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-GenericAPIView"><span class="toc-number">2.</span> <span class="toc-text">3.1.2 GenericAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-DRF%E7%9A%84%E8%AF%B7%E6%B1%82%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.</span> <span class="toc-text">3.1.3 DRF的请求对象</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%EF%BC%89-data"><span class="toc-number">3.1.</span> <span class="toc-text">1）.data</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%EF%BC%89-query-params"><span class="toc-number">3.2.</span> <span class="toc-text">2）.query_params</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%EF%BC%89request-request"><span class="toc-number">3.3.</span> <span class="toc-text">3）request._request</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-4-DRF%E7%9A%84%E5%93%8D%E5%BA%94%E5%AF%B9%E8%B1%A1"><span class="toc-number">4.</span> <span class="toc-text">3.1.4 DRF的响应对象</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%EF%BC%89response%E7%9A%84%E6%9E%84%E9%80%A0%E6%96%B9%E5%BC%8F"><span class="toc-number">4.1.</span> <span class="toc-text">1）response的构造方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%EF%BC%89response%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">4.2.</span> <span class="toc-text">2）response对象的状态码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-5-%E8%A7%86%E5%9B%BE%E7%B1%BB%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">5.</span> <span class="toc-text">3.1.5 视图类源码解析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81View%E7%B1%BB%E7%9A%84%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">5.1.</span> <span class="toc-text">1、View类的源码解析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81APIView%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">5.2.</span> <span class="toc-text">2、APIView源码解析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%E3%80%81GenericAPIView%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-number">5.3.</span> <span class="toc-text">3、GenericAPIView源码解析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-5%E4%B8%AA%E8%A7%86%E5%9B%BE%E6%89%A9%E5%B1%95%E7%B1%BB"><span class="toc-number"></span> <span class="toc-text">3.2  5个视图扩展类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-ListModeMixin"><span class="toc-number">1.</span> <span class="toc-text">(1) ListModeMixin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-CreateModeMixin"><span class="toc-number">2.</span> <span class="toc-text">(2) CreateModeMixin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-RetrieveModelMixin"><span class="toc-number">3.</span> <span class="toc-text">(3) RetrieveModelMixin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-UpdateModelMixin"><span class="toc-number">4.</span> <span class="toc-text">(4) UpdateModelMixin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-DestroyModelMixin"><span class="toc-number">5.</span> <span class="toc-text">(5) DestroyModelMixin</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%87%A0%E4%B8%AA%E5%AD%90%E7%B1%BB%E8%A7%86%E5%9B%BE"><span class="toc-number"></span> <span class="toc-text">3.3 几个子类视图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89CreateAPIView"><span class="toc-number">1.</span> <span class="toc-text">(1）CreateAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89ListAPIView"><span class="toc-number">2.</span> <span class="toc-text">(2）ListAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89RetrieveAPIView"><span class="toc-number">3.</span> <span class="toc-text">(3）RetrieveAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89DestoryAPIView"><span class="toc-number">4.</span> <span class="toc-text">(4）DestoryAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%EF%BC%89UpdateAPIView"><span class="toc-number">5.</span> <span class="toc-text">(5）UpdateAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%EF%BC%89RetrieveUpdateAPIView"><span class="toc-number">6.</span> <span class="toc-text">6）RetrieveUpdateAPIView</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%EF%BC%89RetrieveUpdateDestoryAPIView"><span class="toc-number">7.</span> <span class="toc-text">7）RetrieveUpdateDestoryAPIView</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E8%A7%86%E5%9B%BE%E9%9B%86ViewSet"><span class="toc-number"></span> <span class="toc-text">3.4 视图集ViewSet</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-1-%E5%B8%B8%E7%94%A8%E8%A7%86%E5%9B%BE%E9%9B%86%E7%88%B6%E7%B1%BB"><span class="toc-number">1.</span> <span class="toc-text">3.4.1 常用视图集父类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-2-%E8%A7%86%E5%9B%BE%E9%9B%86%E4%B8%AD%E5%AE%9A%E4%B9%89%E9%99%84%E5%8A%A0action%E5%8A%A8%E4%BD%9C"><span class="toc-number">2.</span> <span class="toc-text">3.4.2 视图集中定义附加action动作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-3-action%E5%B1%9E%E6%80%A7"><span class="toc-number">3.</span> <span class="toc-text">3.4.3 action属性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E8%B7%AF%E7%94%B1Routers"><span class="toc-number"></span> <span class="toc-text">3.5 路由Routers</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-1-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text">3.5.1 使用方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-2-%E8%A7%86%E5%9B%BE%E9%9B%86%E4%B8%AD%E9%99%84%E5%8A%A0action%E7%9A%84%E5%A3%B0%E6%98%8E"><span class="toc-number">2.</span> <span class="toc-text">3.5.2 视图集中附加action的声明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-3-%E8%B7%AF%E7%94%B1router%E5%BD%A2%E6%88%90URL%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">3.5.3 路由router形成URL的方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-JWT"><span class="toc-number"></span> <span class="toc-text">4 JWT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-DRF-JWT"><span class="toc-number"></span> <span class="toc-text">4.1 DRF-JWT</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1-%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">4.1.1 安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">4.1.2 使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-3-%E6%B5%8B%E8%AF%95"><span class="toc-number">3.</span> <span class="toc-text">4.1.3 测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-4-DRF-JWT%E5%BC%80%E5%8F%91"><span class="toc-number">4.</span> <span class="toc-text">4.1.4 DRF-JWT开发</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Django-DRF%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8-Serializer"><span class="toc-number"></span> <span class="toc-text">5 Django DRF序列化器 Serializer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E5%AE%9A%E4%B9%89%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8"><span class="toc-number"></span> <span class="toc-text">5.1 定义序列化器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.</span> <span class="toc-text">常用字段类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%89%E9%A1%B9%E5%8F%82%E6%95%B0"><span class="toc-number">2.</span> <span class="toc-text">选项参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E5%8F%82%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">通用参数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%88%9B%E5%BB%BASerializer%E5%AF%B9%E8%B1%A1"><span class="toc-number"></span> <span class="toc-text">5.2 创建Serializer对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number"></span> <span class="toc-text">5.3 序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-1-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">5.3.1 基本使用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number"></span> <span class="toc-text">5.4 反序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-%E4%BF%9D%E5%AD%98%E6%95%B0%E6%8D%AE"><span class="toc-number"></span> <span class="toc-text">反序列化-保存数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E7%B1%BB%E5%BA%8F%E5%88%97%E5%8C%96%E5%99%A8"><span class="toc-number"></span> <span class="toc-text">模型类序列化器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-number">1.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5"><span class="toc-number">2.</span> <span class="toc-text">指定字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E9%A2%9D%E5%A4%96%E5%8F%82%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">添加额外参数</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/3109476237/" title="nginx的location配置"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover5.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="nginx的location配置"/></a><div class="content"><a class="title" href="/3109476237/" title="nginx的location配置">nginx的location配置</a><time datetime="2024-11-10T14:25:56.000Z" title="发表于 2024-11-10 22:25:56">2024-11-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/4046760165/" title="markdown语法"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover2.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="markdown语法"/></a><div class="content"><a class="title" href="/4046760165/" title="markdown语法">markdown语法</a><time datetime="2024-11-09T15:07:27.000Z" title="发表于 2024-11-09 23:07:27">2024-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/668177610/" title="备忘录"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://i.blogs.es/574569/linux_background_variant_2_by_coryrj1995-d95aiau/original.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="备忘录"/></a><div class="content"><a class="title" href="/668177610/" title="备忘录">备忘录</a><time datetime="2024-11-07T02:33:46.000Z" title="发表于 2024-11-07 10:33:46">2024-11-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/1/" title="test"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover6.webp" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="test"/></a><div class="content"><a class="title" href="/1/" title="test">test</a><time datetime="2024-11-04T12:31:50.000Z" title="发表于 2024-11-04 20:31:50">2024-11-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/1243066710/" title="Hello World"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/default_cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/1243066710/" title="Hello World">Hello World</a><time datetime="2024-10-30T05:28:32.755Z" title="发表于 2024-10-30 13:28:32">2024-10-30</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" rel="external nofollow noreferrer" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2024 By <a class="footer-bar-link" href="/" title="月念尘" target="_blank">月念尘</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">6</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">7</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" rel="external nofollow noreferrer" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">线路切换</div><div class="back-menu-list"><a class="back-menu-item" href="https://ync.aqyync.top/" title="vercel线路"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/logo.png" alt="vercel线路"/><span class="back-menu-item-text">vercel线路</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="http://119.29.59.206:8000/" title="tx云线路"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/logo.png" alt="tx云线路"/><span class="back-menu-item-text">tx云线路</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客2</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://vercel.aqyync.top/" title="vercel线路"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/logo.png" alt="vercel线路"/><span class="back-menu-item-text">vercel线路</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cnblogs.com/yncaqy" title="博客园"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/yncaqy/pic_bed/main/tj/favicon.svg" alt="博客园"/><span class="back-menu-item-text">博客园</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="http://119.29.59.206:5244/" title="Alist"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/alist-org/logo@main/logo.svg" alt="Alist"/><span class="back-menu-item-text">Alist</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="http://119.29.59.206/" title="图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/yncaqy/pic_bed/main/tj/20241110220610.png" alt="图床"/><span class="back-menu-item-text">图床</span></a><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="http://119.29.59.206/thumbnail/index.html" title="视频缩略图生成"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://artplayer.org/assets/img/logo.png" alt="视频缩略图生成"/><span class="back-menu-item-text">视频缩略图生成</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">我的主页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener external nofollow noreferrer" href="https://home.aqyync.top/" title="月念尘的主页"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/yncaqy/pic_bed/main/tj/logo.png" alt="月念尘的主页"/><span class="back-menu-item-text">月念尘的主页</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=6977860977&amp;server=netease"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 剑气长城</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/DRF%E6%A1%86%E6%9E%B6/" style="font-size: 0.88rem;">DRF框架<sup>1</sup></a><a href="/tags/linux%E5%A4%87%E5%BF%98/" style="font-size: 0.88rem;">linux备忘<sup>1</sup></a><a href="/tags/markdown/" style="font-size: 0.88rem;">markdown<sup>1</sup></a><a href="/tags/nginx/" style="font-size: 0.88rem;">nginx<sup>1</sup></a><a href="/tags/test/" style="font-size: 0.88rem; font-weight: 500; color: var(--anzhiyu-lighttext)">test<sup>2</sup></a><a href="/tags/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/" style="font-size: 0.88rem;">线性代数<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><!-- - const showArray = enable ? show && show.split(',') : ['toc','chat','comment']--><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button type="button" title="切换背景" onclick="toggleWinbox()" data-pjax-state><i class="anzhiyufont anzhiyu-icon-instagram"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="6977860977" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("10/03/2024 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        

   ██╗   ██╗███╗   ██╗ ██████╗ █████╗  ██████╗ ██╗   ██╗
   ╚██╗ ██╔╝████╗  ██║██╔════╝██╔══██╗██╔═══██╗╚██╗ ██╔╝
    ╚████╔╝ ██╔██╗ ██║██║     ███████║██║   ██║ ╚████╔╝
     ╚██╔╝  ██║╚██╗██║██║     ██╔══██║██║▄▄ ██║  ╚██╔╝
      ██║   ██║ ╚████║╚██████╗██║  ██║╚██████╔╝   ██║
      ╚═╝   ╚═╝  ╚═══╝ ╚═════╝╚═╝  ╚═╝ ╚══▀▀═╝    ╚═╝

        
        `,
    "已上线",
    dnum,
    "天",
    "©2024 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 月念尘 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script src="https://cdn.jsdelivr.net/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script src="/custom/js/change_bg.js"></script><script async src="/custom/js/fps.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div class="contact-info"><div class="option"><i class="iconfont icon-u"></i><div class="bloktop"></div><div class="text">以德服人<div class="strip"></div></div></div><div class="option"><i class="iconfont icon-e"></i><div class="blok"></div><div class="text"><div class="strip"></div><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">投 喂</span><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a class="about_reward" href="/img/reward/wechat2.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/reward/wechat2.png" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a class="about_reward" href="/img/reward/alipay.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/reward/alipay.png" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></button></div></div></div><div class="option"><i class="iconfont icon-music"></i><div class="blokbottom"></div><div class="text aplayertext"><div class="strip"></div><meting-js class="contact_music" id="6977860977" server="netease" type="playlist" mutex="true" preload="auto" theme="var(--anzhiyu-main)" order="random" list-folded="true"></meting-js></div></div></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>